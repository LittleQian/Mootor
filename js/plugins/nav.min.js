(function(d){var a=function(i){a.init(i,this);this.header=new g(this);this.footer=new k(this);return this},c,e,m,l,h;a.prototype={el:undefined,set:function(n){var i=this.get(n);if(this._config.isMoving===false){this._config.isMoving=true;if(this.current!==i.index){this._config.back=this.current;if(this._config.direction===0){this.history.push(this.current)}this.current=i.index;a.load(this)}}return i},get:function(o){var n;for(n=this._config.count;n--;){if(this.items[n].el.id===o){return this.items[n]}}return null},goBack:function(){if(this.history.length>0){if(this._config.isMoving===false){this._config.direction=-1;this._config.back=this.history.pop();this.set(this.items[this._config.back].el.id)}}return this.items[this.current].index},handleGesture:function(i){a.handleGesture(i,this)}};c=function(i){this.el=i.el;this.id=this.el.id;this.index=i.index;this.height=i.height;this.x=i.x;this.y=i.y;return this};d.extend({getLinks:function(o,p){var n,r,q=[];n=d(o.el).find("."+p._config.navClass);for(r=0;r<n.length;r++){if(n[r].getAttribute("href").replace("#","")!==""){q.push(n[r])}}return q},loadNavigationItem:function(r,o,p){var q=0,n="";for(q=o.navigationItemsCount;q--;){d(o.navigationItems[q]).removeClass("active")}p._config.direction=0;if(p._config.isMoving===false){n=r.el.getAttribute("href");if(n&&n!==""){p.set(n.replace("#",""))}}},initNavigationItems:function(n,o){var q,p;n.navigationItems=c.getLinks(n,o);n.navigationItemsCount=n.navigationItems.length;for(p=n.navigationItemsCount;p--;){q=n.navigationItems[p];if(d(q).hasClass(o._config.navClass)===false){d(q).onTapEnd(function(i){window.location=i.el.href})}else{if(q.getAttribute("href").replace("#","")!==""){d(q).onTapStart(function(i){d(i.el).setClass("active")});d(q).onTapEnd(function(i){c.loadNavigationItem(i,n,o)})}}}n.initNavigation=function(){c.initNavigationItems(n,o)};return n}},c);d.extend({nav:function(i){var n;if(typeof i!=="object"){i={}}i.el=this.el;i._query=this.query;n=a.get(this.query);if(n===undefined){return new a(i)}else{return n}}});d.extend({_collection:[],init:function(n,i){i.el=n.el;i._options=n;a.initProperties(i,n);d(i.el).setClass(i._config.containerClassName);a.initItems(i);d(i.el).onDragMove(i);d(i.el).onDragEnd(i);a.initResizeEvents(i);return i},initProperties:function(i,n){var o;i._config={x:0,y:0,back:0,isMoving:false,direction:0,width:d.view.clientW,height:d.view.clientH,transitions:n.transitions,headerClassName:n.headerClassName?n.headerClassName:"moo-header",footerClassName:n.footerClassName?n.footerClassName:"moo-footer",navClass:n.navLinksClassName?n.navLinksClassName:"moo-nav",hiddenClassName:n.hiddenClassName?n.hiddenClassName:"moo-hidden",margin:n.margin?n.margin:5,containerClassName:n.containerClassName?n.containerClassName:"moo-panels",itemClass:n.itemsClassName?n.itemsClassName:"moo-panel",type:n.type?n.type:"Panels"};if(i._config.transitions===undefined){i._config.transitionDuration=0.25}else{i._config.transitionDuration=0}if(i._config.type==="Panels"){o=j}i._config.navItem=o;i.items=[];i.current=0;i.history=[];a._collection.push(i);i.id=n.id?n.id:n._query},handleGesture:function(n,i){n.e.preventDefault();switch(n.type){case"dragMove":a.move(n,i);break;case"dragEnd":i._config.navItem.checkMove(n,i);break}},nav:function(n,i){n._anchors=i.el.getElementsByClassName(i._options.navClass)},move:function(n,i){var o=i.items[i.current];if(n.isDraggingY!==0&&o.movable!==false){i._config.navItem.move(i,o,n)}},load:function(i){i._config.navItem.load(i)},initResizeEvents:function(i){d(window).bind("resize",function(){setTimeout(function(){if(i.header!==undefined){i._config.height=d.view.clientH-i.header.height}else{i._config.height=d.view.clientH}},1)})},initItems:function(n){var o,p,q=n.el.getElementsByClassName(n._config.itemClass);n.items=[];for(o=0;o<q.length;o++){p=new c({el:q[o],index:o,x:0,y:0});c.initNavigationItems(p,n);n.items.push(p)}n._config.count=o;a.initNavItemStyles(n)},initNavItemStyles:function(i){i._config.navItem.initStyles(i)},preventNativeScrolling:function(){d(document).ready(function(){d(document.body).bind("touchmove",function(i){i.preventDefault();i.stopPropagation()})})},get:function(i){return a._collection.map(function(n){if(n.id===i){return n}})[0]},_scrollBar:function(i){}},a);m=function(n,o){var p;for(p=o._config.count;p--;){o.items[p].el.style.paddingTop=n+"px"}};a.preventNativeScrolling();h=[];l=function(){for(e=h.length;e--;){h[e]()}};if(d._documentIsReady===true){l()}else{d(document).ready(function(){l()})}var g=function(i){this.el=d("header")[0];if(this.el!==null){var n=function(o){o.height=o.el.offsetHeight;o.el.style.height=o.height+"px";m(o.height,i)};h.push(function(){n(i.header)});d(this.el).setClass(i._config.headerClassName);g.initAnchorBack(this,i);g.initNavigationLinks(this,i);g.preventNativeScrolling(this);return this}else{return undefined}};g.prototype={setTitle:function(i){d(this.el).find("h1")[0].innerText=i}};d.extend({initAnchorBack:function(i,n){var o=n._config.anchorBack=d(d(i.el).find(".moo-nav-back")[0]);if(o.el!==undefined){o.hide();o.el.onclick=function(){return false};o.onTapEnd(function(p){n.goBack()})}},preventNativeScrolling:function(i){d(i.el).on("touchmove",function(n){n.preventDefault()})},initNavigationLinks:function(n,o){var q=d(n.el).find(".moo-nav"),p;for(p=q.length;p--;){d(q[p]).onTapEnd(function(i){c.loadNavigationItem(i,n,o)})}}},g);var k=function(i){this.el=d("footer")[0];if(this.el!==null){var n=function(o){o.height=k.el.offsetHeight;o.el.style.height=k.height+"px";m(o.height,i)};h.push(function(){n(i.footer)});d(this.el).setClass(i._config.footerClassName);k.initNavigationLinks(this,i);k.preventNativeScrolling(this);return this}else{return undefined}};d.extend({preventNativeScrolling:function(i){d(i.el).on("touchmove",function(n){n.preventDefault()})},initNavigationLinks:function(n,o){var q=d(n.el).find(".moo-nav"),p;for(p=q.length;p--;){d(q[p]).onTapEnd(function(i){c.loadNavigationItem(i,n,o)})}}},k);var j=function(){},b=function(i){i.duration=i.duration?i.duration:0;i.callback=i.callback?i.callback:function(){};i.y=i.y?i.y:0;i.x=i.x?i.x:0;d(i.el).translateFx({y:i.y,x:i.x},{transitionDuration:i.duration,callback:i.callback})};var f=function(o,i,n){var p=o._config;d(n.el).hide();p.isMoving=false;i.x=0;p.x=0;b({el:o.el,x:0},o);b({el:i.el,x:0},o)};d.extend({load:function(t){var n,u,r,s,v,q,o=t._config,p;n=t.items[t.current];r=t.items[o.back];d(n.el).show();s=o.width+o.margin;if(t.current!==0){o.anchorBack.show()}else{o.anchorBack.hide()}if(o.direction===0||o.back===0){b({el:n.el,x:s},t);n.x=s;s=-s}else{b({el:n.el,x:-s},t);n.x=-s;s=s}window.setTimeout(function(){b({el:t.el,duration:o.transitionDuration,x:s,callback:function(){f(t,n,r)}},t)},1);if(typeof n.onLoad==="function"){n.onLoad()}},initStyles:function(n){var o=0,p={};for(o=n._config.count;o--;){p=n.items[o];if(o>0){b({el:p.el,x:-((n._config.width+n._config.margin)*4),y:0},n);d(p.el).hide()}else{b({el:p.el,x:0},n)}p.height=p.el.offsetHeight;if(n._config.height>p.height){p.height=n._config.height}}},checkMove:function(q,o){var n=o.items[o.current],r=n.height-o._config.height,p;if(o.header!==undefined){r+=o.header.height}if(q.type==="dragEnd"){if(o._config.y>=0||r<-o._config.y){if(o._config.y>0){o._config.y=0}else{o._config.y=-r}for(p=n.navigationItems.length;p--;){d(n.navigationItems[p]).removeClass("active")}b({y:o._config.y,el:n.el,duration:0.25},o)}}},move:function(p,s,r){var n=false;p._config.y=p._config.y+(r.y-r.lastY);var o=p.items[p.current],t=o.height-p._config.height,q;if(p.header!==undefined){t+=p.header.height}if(p._config.transitions===false){if(p._config.y<0&&t>-p._config.y){n=true}}else{n=true}if(n===true){b({el:s.el,y:p._config.y,x:s.x},p)}},setStylesWhenHeaderOrFooterIsActive:function(n,o){var p;for(p=o._config.count;p--;){o.items[p].el.style.paddingTop=n+"px"}}},j)}(Mootor));