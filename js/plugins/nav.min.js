(function(f){var c=function(i){c.init(i,this);this.header=new h(this);this.footer=new e(this);return this},b;c.prototype={el:undefined,set:function(j){var i=this.get(j);if(this._config.isMoving===false){this._config.isMoving=true;if(this.current!==i.index){this._config.back=this.current;if(this._config.direction===0){this.history.push(this.current)}this.current=i.index;c.load(this)}}return i},get:function(k){var j;for(j=this._config.count;j--;){if(this.items[j].el.id===k){return this.items[j]}}return null},goBack:function(){if(this.history.length>0){if(this._config.isMoving===false){this._config.direction=-1;this._config.back=this.history.pop();this.set(this.items[this._config.back].el.id)}}return this.items[this.current].index},handleGesture:function(i){c.handleGesture(i,this)}};b=function(i){this.el=i.el;this.id=this.el.id;this.index=i.index;this.height=i.height;this.x=i.x;this.y=i.y;return this};f.extend({getLinks:function(k,l){var j,n,m=[];j=f(k.el).find("."+l._config.navClass);for(n=0;n<j.length;n++){if(j[n].getAttribute("href").replace("#","")!==""){m.push(j[n])}}return m},loadNavigationItem:function(n,k,l){var m=0,j="";for(m=k.navigationItemsCount;m--;){f(k.navigationItems[m]).removeClass("active")}l._config.direction=0;if(l._config.isMoving===false){j=n.el.getAttribute("href");if(j&&j!==""){l.set(j.replace("#",""))}}},initNavigationItems:function(j,k){var m,l;j.navigationItems=b.getLinks(j,k);j.navigationItemsCount=j.navigationItems.length;for(l=j.navigationItemsCount;l--;){m=j.navigationItems[l];if(f(m).hasClass(k._config.navClass)===false){f(m).onTapEnd(function(i){window.location=i.el.href})}else{if(m.getAttribute("href").replace("#","")!==""){f(m).onTapStart(function(i){f(i.el).setClass("active")});f(m).onTapEnd(function(i){b.loadNavigationItem(i,j,k)})}}}return j}},b);f.extend({nav:function(i){var j;if(typeof i!=="object"){i={}}i.el=this.el;i._query=this.query;j=c.get(this.query);if(j===undefined){return new c(i)}else{return j}}});f.extend({_collection:[],init:function(j,i){i.el=j.el;i._options=j;c.initProperties(i,j);f(i.el).setClass(i._config.containerClassName);c.initItems(i);f(i.el).onDragMove(i);f(i.el).onDragEnd(i);c.initResizeEvents(i);return i},initProperties:function(i,j){var k;i._config={x:0,y:0,back:0,isMoving:false,direction:0,width:f.view.clientW,height:f.view.clientH,headerClassName:j.headerClassName?j.headerClassName:"moo-header",navClass:j.navLinksClassName?j.navLinksClassName:"moo-nav",hiddenClassName:j.hiddenClassName?j.hiddenClassName:"moo-hidden",margin:j.margin?j.margin:5,containerClassName:j.containerClassName?j.containerClassName:"moo-panels",itemClass:j.itemsClassName?j.itemsClassName:"moo-panel",type:j.type?j.type:"Panels"};if(i._config.type==="Panels"){k=d}i._config.navItem=k;i.items=[];i.current=0;i.history=[];c._collection.push(i);i.id=j.id?j.id:j._query},handleGesture:function(j,i){j.e.preventDefault();switch(j.type){case"dragMove":c.move(j,i);break;case"dragEnd":i._config.navItem.checkMove(j,i);break}},nav:function(j,i){j._anchors=i.el.getElementsByClassName(i._options.navClass)},move:function(j,i){var k=i.items[i.current];if(j.isDraggingY!==0&&k.movable!==false){i._config.navItem.move(i,k,j)}},load:function(i){i._config.navItem.load(i)},initResizeEvents:function(i){f(window).bind("resize",function(){setTimeout(function(){if(i.header!==undefined){i._config.height=f.view.clientH-i.header.height}else{i._config.height=f.view.clientH}},1)})},initItems:function(j){var k,l,m=j.el.getElementsByClassName(j._config.itemClass);j.items=[];for(k=0;k<m.length;k++){l=new b({el:m[k],index:k,x:0,y:0});b.initNavigationItems(l,j);j.items.push(l)}j._config.count=k;c.initNavItemStyles(j)},initNavItemStyles:function(i){i._config.navItem.initStyles(i)},preventNativeScrolling:function(){f(document).ready(function(){f(document.body).bind("touchmove",function(i){i.preventDefault();i.stopPropagation()})})},get:function(i){return c._collection.map(function(j){if(j.id===i){return j}})[0]},_scrollBar:function(i){}},c);c.preventNativeScrolling();var h=function(i){this.el=f("header")[0];if(this.el!==null){this.height=this.el.offsetHeight;this.el.style.height=this.height+"px";f(this.el).setClass(i._config.headerClassName);h.initAnchorBack(this,i);h.initNavigationLinks(this,i);h.preventNativeScrolling(this);i._config.navItem.setStylesWhenHeaderActive(this.height,i);return this}else{return undefined}};h.prototype={setTitle:function(i){f(this.el).find("h1")[0].innerText=i}};f.extend({initAnchorBack:function(i,j){var k=j._config.anchorBack=f(f(i.el).find(".moo-nav-back")[0]);k.hide();k.el.onclick=function(){return false};k.onTapEnd(function(l){j.goBack()})},preventNativeScrolling:function(i){f(i.el).on("touchmove",function(j){j.preventDefault()})},initNavigationLinks:function(j,k){var m=f(j.el).find(".moo-nav"),l;for(l=m.length;l--;){f(m[l]).onTapEnd(function(i){b.loadNavigationItem(i,j,k)})}}},h);var e=function(i){};var d=function(){},g=function(i){i.duration=i.duration?i.duration:0;i.callback=i.callback?i.callback:function(){};i.y=i.y?i.y:0;i.x=i.x?i.x:0;f(i.el).translateFx({y:i.y,x:i.x},{transitionDuration:i.duration,callback:i.callback})};var a=function(k,i,j){var l=k._config;f(j.el).hide();l.isMoving=false;i.x=0;l.x=0;g({el:k.el,x:0},k);g({el:i.el,x:0},k)};f.extend({load:function(p){var j,q,n,o,r,m,k=p._config,l;j=p.items[p.current];n=p.items[k.back];f(j.el).show();o=k.width+k.margin;if(p.current!==0){k.anchorBack.show()}else{k.anchorBack.hide()}if(k.direction===0||k.back===0){g({el:j.el,x:o},p);j.x=o;o=-o}else{g({el:j.el,x:-o},p);j.x=-o;o=o}window.setTimeout(function(){g({el:p.el,duration:0.25,x:o,callback:function(){a(p,j,n)}},p)},1);if(typeof j.onLoad==="function"){j.onLoad()}},initStyles:function(j){var k=0,l={};for(k=j._config.count;k--;){l=j.items[k];if(k>0){g({el:l.el,x:-((j._config.width+j._config.margin)*4),y:0},j);f(l.el).hide()}else{g({el:l.el,x:0},j)}l.height=l.el.offsetHeight;if(j._config.height>l.height){l.height=j._config.height}}},checkMove:function(m,k){var j=k.items[k.current],n=j.height-k._config.height,l;if(k.header!==undefined){n+=k.header.height}if(m.type==="dragEnd"){if(k._config.y>=0||n<-k._config.y){if(k._config.y>0){k._config.y=0}else{k._config.y=-n}for(l=j.navigationItems.length;l--;){f(j.navigationItems[l]).removeClass("active")}g({y:k._config.y,el:j.el,duration:0.25},k)}}},move:function(i,k,j){i._config.y=i._config.y+(j.y-j.lastY);g({el:k.el,y:i._config.y,x:k.x},i)},setStylesWhenHeaderActive:function(j,k){var l;for(l=k._config.count;l--;){k.items[l].el.style.paddingTop=j+"px"}}},d)}(Mootor));