(function(f){var r={radio:'<div moo-template="foreach: input"><div class="moo-ui-radio"><label><span class="moo-ui-radio-label" moo-template="text: this.label"></span><span class="moo-ui-radio-icon"> &nbsp;</span></label></div></div>',checkbox:'<div moo-template="foreach: input"><div class="moo-ui-checkbox"><label><span class="moo-ui-checkbox-label" moo-template="text: this.label"></span><span class="moo-ui-checkbox-icon"> &nbsp;</span></label></div></div>',overlay:"<div class='moo-overlay'></div>",loading:"<div class='moo-ui-loading'><div class='moo-ui-loading-block moo-loading-01'></div><div class='moo-ui-loading-block moo-loading-02'></div><div class='moo-ui-loading-block moo-loading-03'></div><div class='moo-ui-loading-block moo-loading-04'></div><div class='moo-ui-loading-block moo-loading-05'></div><div class='moo-ui-loading-block moo-loading-06'></div><div class='moo-ui-loading-block moo-loading-07'></div><div class='moo-ui-loading-block moo-loading-08'></div></div>",modal:"<div class='moo-ui-modal-container'><div class='moo-ui-modal-panel' moo-template='html: this.html'></div></div>",_switch:"<div class='moo-ui-switch'><b><span class='moo-before'>I</span><span class='moo-button'>&nbsp;</span><span class='moo-after'>O</span></b></div>",text:'<span class="cleanbox">&times</span>',select:'<div class="moo-ui-select-container"><span class="moo-ui-select-text"></span><span class="mo-ui-select-link"> &#9660;</span><div class="moo-ui-select-menu" style="height:217px;display:none"><div class="moo-ui-select-wrapper"><ul class="moo-ui-select-list" moo-template="foreach: option"><li moo-template="text: this.text"></li></ul></div></div>'},k=function(t){return t.split(" ").join("")},s=function(B){var z=B.template,A=B.self,t=[],w=document.createElement("div"),y=[],u=0,x=[],v;w.innerHTML=z;y=w.getElementsByTagName("*");for(u=y.length;u--;){if(y[u].getAttribute("moo-template")!==null){x=k(y[u].getAttribute("moo-template")).split(":");t.push({el:y[u],key:x[0],value:x[1]})}if((v=y[u].getAttribute("moo-foreach-index"))!==null){t[u].index=v}}if(c(t)===true){for(u=t.length;u--;){if(t[u].key==="foreach"){i(t[u],A)}}}else{for(u=t.length;u--;){switch(t[u].key){case"text":d(t[u],A);break;case"html":e(t[u],A);break}}}return w.innerHTML},c=function(u){var t;for(t=u.length;t--;){if(u[t].key==="foreach"){return true}}return false},i=function(t,A){var C=t.value,x=A.input.getElementsByTagName(C),u=0,B={},v=t.el.innerHTML,y=[],w=[],z=document.createElement("div");A.items=[];y=f(A.input).find(C);if(C==="input"){w=f(A.input).find("label")}for(u=0;u<y.length;u++){A.items.push({el:y[u],text:y[u].innerText});if(C==="input"){A.items[A.items.length-1].label=w[u]}}t.el.innerHTML="";for(u=0;u<x.length;u++){B=document.createElement("div");B.innerHTML=v;B.firstChild.setAttribute("moo-foreach-index",u);B.innerHTML=s({template:B.innerHTML,self:A});z.appendChild(B.firstChild)}t.el.innerHTML=z.innerHTML},d=function(v,t){var u=v.index,x="",w="";if(v.value.indexOf("this.")>-1){x=v.value.replace("this.","");w=t.items[u][x];if(typeof w==="string"){v.el.innerText=w}else{v.el.innerText=w.innerText}}},e=function(v,t){var u=v.index,w="";if(v.value.indexOf("this.")>-1){w=v.value.replace("this.","");v.el.innerHTML=t[w]}};var h=function(){if(h.el===undefined){h._makeHTML({type:"overlay",object:h})}this.el=h.el;return this},b=function(){if(b.el===undefined){h._makeHTML({type:"modal",object:b})}this.el=b.el;return this},g=function(){if(g.el===undefined){h._makeHTML({type:"loading",object:g})}this.el=g.el;return this};g.prototype=h.prototype={show:function(){f(this.el).removeClass("moo-hidden")},hide:function(){f(this.el).setClass("moo-hidden")},};b.prototype={html:function(t){this.html=t;this.el.innerHTML=s({template:this.el.innerHTML,self:this})}};f.extend(h.prototype,b.prototype);f.extend({el:undefined,_makeHTML:function(u){var w=u.type,t=u.object,v=document.createElement("div");v.innerHTML=r[w];t.el=v.firstChild;f(t.el).setClass("moo-hidden");f(document.body).el.appendChild(t.el)}},h);var n=function(){};var p=function(u){var t=this;this.input=u.el;f(this.input).hide();this._makeHTML();this._setTouchEvents();if(u.value){this.input.value=u.value}this.toggle(this.input.value);return this};p.prototype={_makeHTML:function(){var t;t=document.createElement("div");t.innerHTML=r._switch;this.el=t.firstChild;this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var v=this,w=f(v.el).find("b")[0],t=v.el.offsetWidth-32,x=t/3,u=0;v.x=0;v.isDragging=0;f(this.el).onTapEnd(function(y){v.toggle()});f(this.el).onSwipeRight(function(y){v._swipe=1});f(this.el).onSwipeLeft(function(y){v._swipe=-1});f(this.el).onDragMove(function(y){var z=v.x+(y.x-y.lastX);v.isDragging=1;f(v.el).removeClass("moo-on");f(v.el).removeClass("moo-off");y.e.stopPropagation();if((z<=t)&&(z>-4)){v.x=z;f(w).translateFx({x:v.x,y:0},{transitionDuration:0})}});f(this.el).onDragEnd(function(y){var z;y.e.stopPropagation();f(w).cleanFx();if(v._swipe!==0&&y.time<400){if(v._swipe===1){v.toggle(1)}else{v.toggle(0)}}else{if(v.isDragging===1){v.isDragging=0;if(v.x<(t/2)){v.toggle(0)}else{v.toggle(1)}}}})},toggle:function(u){var t=f(this.el);if(u!==undefined){this.value=+u}else{if(this.value===0){this.value=1}else{this.value=0}}if(this.value===0){t.removeClass("moo-on");t.setClass("moo-off")}else{t.removeClass("moo-off");t.setClass("moo-on")}this.input.value=this.value;if(typeof this.onChange==="function"){this.onChange()}},on:function(t,u){switch(t){case"change":this.onChange=u;break}}};var l=function(u){var t=this,v=0;this.input=u.el;f(this.input).hide();this._makeHTML();this.mooItems=f(this.el).find(".moo-ui-checkbox");for(v=this.mooItems.length;v--;){f(this.mooItems[v]).onTapEnd(function(w){t.activate(f(w.e.target))})}};l.prototype={_makeHTML:function(){var u=r.checkbox,t;this.el=document.createElement("div");this.el.innerHTML=s({template:u,self:this});this.input.parentElement.appendChild(this.el)},activate:function(w){var v=0,u=0,t={},z,x,y=true;if(f(w.el).hasClass("moo-ui-checkbox-icon")===false){z=f(w.el.parentElement).find(".moo-ui-checkbox-icon")[0]}else{z=w.el}for(v=this.mooItems.length;v--;){t=f(this.mooItems[v]).find(".moo-ui-checkbox-icon");for(u=t.length;u--;){if(t[u]===z){if(f(t[u]).hasClass("moo-active")===false){f(t[u]).setClass("moo-active");y=true}else{f(t[u]).removeClass("moo-active");y=false}x=v}}}if(y===true){this.items[x].el.setAttribute("checked","checked")}else{this.items[x].el.removeAttribute("checked","checked")}}};var m=function(u){var t=this,v=0;this.input=u.el;f(this.input).hide();this._makeHTML();this.mooItems=f(this.el).find(".moo-ui-radio");for(v=this.mooItems.length;v--;){f(this.mooItems[v]).onTapEnd(function(w){t.activate(f(w.e.target))})}};m.prototype={_makeHTML:function(){var u=r.radio,t;this.el=document.createElement("div");this.el.innerHTML=s({template:u,self:this});this.input.parentElement.appendChild(this.el)},activate:function(w){var v=0,u=0,t={},x;if(f(w.el).hasClass("moo-ui-radio-icon")===false){x=f(w.el.parentElement).find(".moo-ui-radio-icon")[0]}else{x=w.el}for(v=this.mooItems.length;v--;){t=f(this.mooItems[v]).find(".moo-ui-radio-icon");for(u=t.length;u--;){if(t[u]!==x){f(t[u]).removeClass("moo-active");this.items[v].el.removeAttribute("checked")}else{f(t[u]).setClass("moo-active");this.selectedIndex=v}}}this.items[this.selectedIndex].el.setAttribute("checked","checked")}};var j=function(u){var t=this,v=0,w=this.pseudoItems=[];this.y=0;this.input=u.el;this.position=u.position;f(this.input).hide();this._makeHTML();this._setTouchEvents();w=f(this.ul).find("li");for(v=0;v<w.length;v++){this.pseudoItems.push({el:w[v],mooSelectIndex:v})}return this};j.prototype={_makeHTML:function(){var u=document.createElement("div"),t=r.select;this.el=u;this.el.innerHTML=s({template:t,self:this});if(this.position=="top"){f(this.el).setClass("moo-top")}else{if(this.position=="bottom"){f(this.el).setClass("moo-bottom")}}this.input.parentElement.appendChild(this.el);this.ul=f(this.el).find("ul")[0];this.box=f(this.el).find(".moo-ui-select-menu")[0];this.textspan=f(this.el).find(".moo-ui-select-text")[0]},_setTouchEvents:function(){var t=this;f(this.el).onTapEnd(function(u){f(t.box).show()});f(this.el).onDragStart(a);f(this.ul).onTapEnd(function(u){a(u);t.select(u.e.target.getAttribute("moo-foreach-index"))});f(this.ul).onDragMove(function(u){var v;a(u);v=t.y+(u.y-u.lastY);if((v<=0)&&(v>=-(t.ul.offsetHeight-160))){t.y=v;f(t.ul).translateFx({x:0,y:t.y},{})}})},select:function(t){var u;f(this.box).hide();this.value=this.pseudoItems[t].el.getAttribute("moo-select-value");this.input.value=this.value;for(u=0;u<this.pseudoItems.length;u++){f(this.pseudoItems[u].el).removeClass("selected")}f(this.pseudoItems[t].el).setClass("selected");f(this.textspan).html(this.pseudoItems[t].el.innerHTML)}};var o=function(u){var t=this;this.el=this.input=u.el;if(u.value!==undefined){this.value=u.value}else{this.value=""}this._makeHTML();f(this.el).onDragStart(a);f(this.el).onTapEnd(function(v){v.el.focus();a(v)});f(this.cleanbox).onTapEnd(function(){t.clean()});return this};o.prototype={_makeHTML:function(){var v,u=this.el.parentElement,t=this;this.cleanbox=document.createElement("div");this.cleanbox.innerHTML=r.text;this.input.value=this.value;v=document.createElement("div");f(v).setClass("moo-ui-text");v.appendChild(this.cleanbox);v.appendChild(this.input);this.input.onkeyup=function(){t.value=t.input.value;if(typeof t.onChange==="function"){t.onChange()}};u.appendChild(v)},clean:function(){this.input.value="";this.input.focus()},on:function(t,u){switch(t){case"change":this.onChange=u;break}}};var q=function(u){var t=this;this.el=this.input=u.el;this._makeHTML();f(this.el).onDragStart(a);f(this.el).onTapEnd(function(v){v.el.focus();a(v)});return this};q.prototype={_makeHTML:function(){var u,t=this.el.parentElement;u=document.createElement("div");f(u).setClass("moo-ui-textarea");u.appendChild(this.input);t.appendChild(u)},};f.extend({ui:function(t){t.el=this.el;switch(t.type){case"Switch":return new p(t);break;case"Text":return new o(t);break;case"TextArea":return new q(t);break;case"Select":return new j(t);break;case"Radio":return new m(t);break;case"Checkbox":return new l(t);break}},});f.extend({ui:{overlay:function(){return new h()},loading:function(){return new g()},modal:function(t){return new b()}}},f);var a=function(t){t.e.stopPropagation();t.e.preventDefault()}}(Mootor));