(function(f){var u={radio:'<div moo-template="foreach: input"><div class="moo-ui-radio"><label><span class="moo-ui-radio-label" moo-template="text: this.label"></span><span class="moo-ui-radio-icon"> &nbsp;</span></label></div></div>',checkbox:'<div moo-template="foreach: input"><div class="moo-ui-checkbox"><label><span class="moo-ui-checkbox-label" moo-template="html: this.label"></span><span class="moo-ui-checkbox-icon"> &nbsp;</span></label></div></div>',overlay:"<div class='moo-overlay'></div>",loading:"<div class='moo-ui-loading'><div class='moo-ui-loading-block moo-loading-01'></div><div class='moo-ui-loading-block moo-loading-02'></div><div class='moo-ui-loading-block moo-loading-03'></div><div class='moo-ui-loading-block moo-loading-04'></div><div class='moo-ui-loading-block moo-loading-05'></div><div class='moo-ui-loading-block moo-loading-06'></div><div class='moo-ui-loading-block moo-loading-07'></div><div class='moo-ui-loading-block moo-loading-08'></div></div>",modal:"<div class='moo-ui-modal-container'><div class='moo-ui-modal-panel' moo-template='html: this.html'></div></div>",toggleswitch:"<div class='moo-ui-switch'><b><span class='moo-before'>I</span><span class='moo-button'>&nbsp;</span><span class='moo-after'>O</span></b></div>",text:'<span class="cleanbox">&times</span>',select:'<div class="moo-ui-select-container"><span class="moo-ui-select-text"></span><span class="moo-ui-select-link"> &#9660;</span><div class="moo-ui-select-menu" style="height:217px;display:none"><div class="moo-ui-select-wrapper"><ul class="moo-ui-select-list" moo-template="foreach: option"><li moo-template="text: this.text"></li></ul></div></div></div>',camera:"<div class='moo-ui-image-container'><header><a class='moo-ui-add-new' href='#takepic'>Take a picture</a><a class='moo-ui-add-filed' href='#choosepic'>Choose a picture</a><a class='moo-ui-delete' href='#delete'></a><a class='moo-ui-add-comment' href='#addcomment'></a></header><div class='moo-ui-image-panel'><ul class='moo-image-list'><li class='moo-image-wrapper'><div class='moo-image'></div></li></ul></div></div>"},m=function(w){return w.split(" ").join("")},v=function(E){var C=E.template,D=E.self,w=[],z=document.createElement("div"),B=[],x=0,A=[],y;z.innerHTML=C;B=z.getElementsByTagName("*");for(x=B.length;x--;){if(B[x].getAttribute("moo-template")!==null){A=m(B[x].getAttribute("moo-template")).split(":");w.push({el:B[x],key:A[0],value:A[1]})}if((y=B[x].getAttribute("moo-foreach-index"))!==null){w[x].index=y}}if(c(w)===true){for(x=w.length;x--;){if(w[x].key==="foreach"){k(w[x],D)}}}else{for(x=w.length;x--;){switch(w[x].key){case"text":d(w[x],D);break;case"html":e(w[x],D);break}}}return z.innerHTML},c=function(x){var w;for(w=x.length;w--;){if(x[w].key==="foreach"){return true}}return false},k=function(w,E){var G=w.value,A=E.input.getElementsByTagName(G),x=0,F={},y=w.el.innerHTML,B=[],D,z=[],C=document.createElement("div");E.items=[];B=f(E.input).find(G);if(G==="input"){z=f(E.input).find("label")}for(x=0;x<B.length;x++){E.items.push({el:B[x],text:B[x].innerText});D=E.items[E.items.length-1];if(G==="input"){D.label=z[x]}if(D.el.value!==undefined){D.value=D.el.value}}w.el.innerHTML="";for(x=0;x<A.length;x++){F=document.createElement("div");F.innerHTML=y;F.firstChild.setAttribute("moo-foreach-index",x);F.firstChild.setAttribute("moo-foreach-value",E.items[x].value);F.innerHTML=v({template:F.innerHTML,self:E});C.appendChild(F.firstChild)}w.el.innerHTML=C.innerHTML},d=function(y,w){var x=y.index,A="",z="";if(y.value.indexOf("this.")>-1){A=y.value.replace("this.","");z=w.items[x][A];if(z!==undefined){if(typeof z==="string"){y.el.innerText=z}else{y.el.innerText=z.innerText}}}},e=function(y,w){var x=y.index,A="",z="";if(y.value.indexOf("this.")>-1){A=y.value.replace("this.","");z=w.items[x][A];if(typeof z==="string"){y.el.innerHTML=z}else{y.el.innerHTML=z.innerHTML}z.parentElement.removeChild(z)}};var j=function(){if(j.el===undefined){j._makeHTML({type:"overlay",object:j})}this.el=j.el;return this},b=function(){if(b.el===undefined){j._makeHTML({type:"modal",object:b})}this.el=b.el;return this},h=function(){if(h.el===undefined){j._makeHTML({type:"loading",object:h})}this.el=h.el;return this};h.prototype=j.prototype={show:function(){f(this.el).removeClass("moo-hidden")},hide:function(){f(this.el).setClass("moo-hidden")}};b.prototype={html:function(w){this.html=w;this.el.innerHTML=v({template:this.el.innerHTML,self:this})}};f.extend(j.prototype,b.prototype);f.extend({el:undefined,_makeHTML:function(x){var z=x.type,w=x.object,y=document.createElement("div");y.innerHTML=u[z];w.el=y.firstChild;f(w.el).setClass("moo-hidden");f(document.body).el.appendChild(w.el)}},j);var q=function(){};var o=function(w){this.input=w.el;f(this.input).hide();this._makeHTML();this._setTouchEvents();if(w.value){this.input.value=w.value}this.toggle(this.input.value);return this};o.prototype={_makeHTML:function(){var w;w=document.createElement("div");w.innerHTML=u.toggleswitch;this.el=w.firstChild;this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var y=this,z=f(y.el).find("b")[0],w=y.el.offsetWidth-32,x=0;y.x=0;y.isDragging=0;f(this.el).onTapEnd(function(A){y.toggle()});f(this.el).onSwipeRight(function(A){y._swipe=1});f(this.el).onSwipeLeft(function(A){y._swipe=-1});f(this.el).onDragMove(function(A){var B=y.x+(A.x-A.lastX);y.isDragging=1;f(y.el).removeClass("moo-on");f(y.el).removeClass("moo-off");A.e.stopPropagation();if((B<=w)&&(B>-4)){y.x=B;f(z).translateFx({x:y.x,y:0},{transitionDuration:0})}});f(this.el).onDragEnd(function(A){A.e.stopPropagation();f(z).cleanFx();if(y._swipe!==0&&A.time<400){if(y._swipe===1){y.toggle(1)}else{y.toggle(0)}}else{if(y.isDragging===1){y.isDragging=0;if(y.x<(w/2)){y.toggle(0)}else{y.toggle(1)}}}})},toggle:function(x){var w=f(this.el);if(x!==undefined){this.value=+x}else{if(this.value===0){this.value=1}else{this.value=0}}if(this.value===0){w.removeClass("moo-on");w.setClass("moo-off")}else{w.removeClass("moo-off");w.setClass("moo-on")}this.input.value=this.value;if(typeof this.onChange==="function"){this.onChange()}},on:function(w,x){if(w==="change"){this.onChange=x}}};var n=function(w){var x=0,y=this.pseudoItems=[];this.input=w.el;this.value=[];f(this.input).hide();this._makeHTML();y=f(this.container).find("div");for(x=0;x<y.length;x++){this.pseudoItems.push({el:y[x],value:y[x].value,mooSelectIndex:x})}this._setTouchEvents();if(w.value!==undefined){this.selectByValue(w.value)}return this};n.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=v({template:u.checkbox,self:this});this.container=f(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var w=this,x=0;for(x=0;x<this.pseudoItems.length;x++){f(this.pseudoItems[x].el).onTapEnd(function(z){var y=f(z.el);a(z);if(y.hasClass("moo-active")){w.unselect(z.el.getAttribute("moo-foreach-index"))}else{w.select(z.el.getAttribute("moo-foreach-index"))}})}},select:function(w){if(this.value.indexOf(w)<0){this.value.push(w.toString());this.items[w].el.setAttribute("checked","checked");f(this.pseudoItems[w].el).setClass("moo-active")}},unselect:function(w){this.value.splice(this.value.indexOf(w),1);this.items[w].el.removeAttribute("checked","");f(this.pseudoItems[w].el).removeClass("moo-active")},unselectAll:function(){var w=0;for(w=this.items.length;w--;){this.unselect(w)}},selectByValue:function(y){var x,w;if(Object.prototype.toString.call(y)!=="[object Array]"){y=[y]}for(x=this.items.length;x--;){for(w=y.length;w--;){if(this.items[x].value===y[w]){f(this.pseudoItems[x].el).setClass("moo-active");this.select(x)}}}}};var p=function(w){var x=0,y=this.pseudoItems=[];this.input=w.el;f(this.input).hide();this._makeHTML();y=f(this.container).find("div");for(x=0;x<y.length;x++){this.pseudoItems.push({el:y[x],value:y[x].value,mooSelectIndex:x})}this._setTouchEvents();if(w.value!==undefined){this.selectByValue(w.value)}return this};p.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=v({template:u.radio,self:this});this.container=f(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var w=this,x=0;for(x=0;x<this.pseudoItems.length;x++){f(this.pseudoItems[x].el).onTapEnd(function(y){a(y);w.select(y.el.getAttribute("moo-foreach-index"))})}},select:function(x){var w=this,y;for(y=0;y<w.pseudoItems.length;y++){f(w.pseudoItems[y].el).removeClass("moo-active");w.pseudoItems[y].el.removeAttribute("checked","checked")}f(w.pseudoItems[x].el).setClass("moo-active");this.value=this.items[x].value;this.selectedIndex=x;this.input.selectedIndex=x;this.items[this.selectedIndex].el.setAttribute("checked","checked")},selectByValue:function(x){var w;for(w=this.items.length;w--;){if(this.items[w].value===x){this.select(w)}}}};var l=function(w){var x=0,y=this.pseudoItems=[];this.y=0;this.input=w.el;this.position=w.position;f(this.input).hide();this._visibility="hidden";this._makeHTML();this._setTouchEvents();y=f(this.ul).find("li");for(x=0;x<y.length;x++){this.pseudoItems.push({el:y[x],mooSelectIndex:x})}if(w.value!==undefined){this.selectByValue(w.value)}return this};l.prototype={_makeHTML:function(){var x=document.createElement("div"),w=u.select;x.innerHTML=v({template:w,self:this});this.el=x.firstChild;if(this.position==="top"){f(this.el).setClass("moo-top")}else{if(this.position==="bottom"){f(this.el).setClass("moo-bottom")}}this.input.parentElement.appendChild(this.el);this.ul=f(this.el).find("ul")[0];this.box=f(this.el).find(".moo-ui-select-menu")[0];this.textspan=f(this.el).find(".moo-ui-select-text")[0]},_setTouchEvents:function(){var w=this;f(this.el).onTapEnd(function(x){if(w._visibility!=="visible"){f(w.box).show();w._visibility="visible"}else{f(w.box).hide();w._visibility="hidden"}});f(this.el).onDragStart(a);f(this.ul).onTapEnd(function(y){var x;a(y);for(x=0;x<w.pseudoItems.length;x++){f(w.pseudoItems[x].el).removeClass("selected")}f(y.e.target).setClass("selected");w.select(y.e.target.getAttribute("moo-foreach-index"))});f(this.ul).onDragMove(function(x){var y;a(x);y=w.y+(x.y-x.lastY);if((y<=0)&&(y>=-(w.ul.offsetHeight-160))){w.y=y;f(w.ul).translateFx({x:0,y:w.y},{})}})},select:function(x){var w=this;window.setTimeout(function(){f(w.box).hide();w._visibility="hidden"},100);this.value=this.items[x].value;this.selectedIndex=x;this.input.selectedIndex=x;f(this.textspan).html(this.pseudoItems[x].el.innerHTML)},selectByValue:function(x){var w;for(w=this.items.length;w--;){if(this.items[w].value===x){this.select(w)}}}};var r=function(x){var w=this;this.el=this.input=x.el;if(x.value!==undefined){this.el.value=x.value}this.value=w.el.value;this._makeHTML();f(this.el).onDragStart(a);f(this.el).onTapEnd(function(y){y.el.focus();y.el.onblur=function(){window.scrollTo(0,0)};a(y)});f(this.cleanbox).onTapEnd(function(){w.clean()});return this};r.prototype={_makeHTML:function(){var y,x=this.el.parentElement,w=this;this.cleanbox=document.createElement("div");this.cleanbox.innerHTML=u.text;y=document.createElement("div");f(y).setClass("moo-ui-text");y.appendChild(this.cleanbox);y.appendChild(this.input);f(this.input).on("keyup",function(z){w.value=w.input.value;if(typeof w.onChange==="function"){w.onChange()}});x.appendChild(y)},clean:function(){this.input.value="";this.input.focus()},on:function(w,x){if(w==="change"){this.onChange=x}}};var s=function(x){var w=this;this.el=this.input=x.el;if(x.value!==undefined){this.el.innerHTML=x.value}this.value=w.el.innerHTML;this._makeHTML();f(this.el).onDragStart(a);f(this.el).onTapEnd(function(y){y.el.focus();a(y)});return this};s.prototype={_makeHTML:function(){var y,x=this.el.parentElement,w=this;f(this.input).on("keyup",function(z){w.value=w.input.value});y=document.createElement("div");f(y).setClass("moo-ui-textarea");y.appendChild(this.input);x.appendChild(y)}};var g=function(w){this.input=w.el;this.position=w.position;this.count=0;g._makeHTML(w,this);g._setTouchEvents(this);g._initProperties(this,w);if(w.value!==undefined){this.value=w.value}else{this.value=[]}return this};g.prototype={show:function(){if(typeof this.onShowBox==="function"){this.onShowBox()}f(this.el).show();this._visibility="visible"},hide:function(){f(this.el).hide();this._visibility="hidden"},onShowBox:function(w){this.onShowBox=w},onCamera:function(w){this.onCamera=w},onSuccess:function(w){this.onSuccess=w},onFail:function(w){this.onFail=w},push:function(A){var w=document.createElement("div"),z,y=this,x;w.innerHTML=this.imageWrapper.outerHTML;x=f(w).find(".moo-image");z=x[0];z.setAttribute("moo-index",this.count);f(z).onTapEnd(function(E){var D=f(E.el),C,B=f(y.imageList).find("li");if(D.hasClass("moo-active")===false){for(C=B.length;C--;){f(B[C].firstChild).removeClass("moo-active")}f(E.el).setClass("moo-active");y.itemSelected=E.el.getAttribute("moo-index")}else{f(E.el).removeClass("moo-active")}});z.appendChild(A);this.value.push(A.getAttribute("src"));f(w.firstChild).show();this.imageList.appendChild(w.firstChild);f(this.el).removeClass("moo-empty");this.count++},clear:function(){var w=f(this.imageList).find("li"),x=0;for(x=w.length;x--;){this.imageList.removeChild(w[x])}this.count=0;this.value=[]}};f.extend({_makeHTML:function(y,x){var z=document.createElement("div"),w;z.innerHTML=u.camera;x.el=z.firstChild;w=f(x.el);w.setClass("moo-empty");if(x.position==="top"){w.setClass("moo-top")}else{if(x.position==="bottom"){w.setClass("moo-bottom")}}x.takeButton=w.find(".moo-ui-add-new")[0];x.chooseButton=w.find(".moo-ui-add-filed")[0];x.imageWrapper=w.find(".moo-image-wrapper")[0];x.imageList=w.find(".moo-image-list")[0];w.hide();x._visibility="hidden";x.input.appendChild(x.el);f(x.imageWrapper).hide()},_setTouchEvents:function(w){f(w.input).onTapEnd(function(){if(w._visibility==="hidden"){w.show()}else{w.hide()}});f(w.el).onTapEnd(function(){w.hide()});f(w.takeButton).onTapEnd(function(){g.camera(w)});f(w.chooseButton).onTapEnd(function(){g.camera(w,"album")})},_initProperties:function(w,x){w.quality=w.quality?w.quality:50;w.width=w.width?w.width:1024;w.height=w.height?w.height:768},camera:function(w,x){var y,z;if(typeof w.onCamera==="function"){w.onCamera()}if(w.disabled!==true){if(window.Camera!==undefined){if(x==="album"){y=window.Camera.PictureSourceType.SAVEDPHOTOALBUM}z=function(A){w.onSuccess(A)};navigator.camera.getPicture(z,w.onFail,{quality:w.quality,destinationType:window.Camera.DestinationType.FILE_URI,sourceType:y,targetWidth:w.width,targetHeight:w.height})}else{console.log("Not camera! using sample pic");w.onSuccess("img/temp/samplepic.jpg")}}}},g);var i=function(){};f.extend({ui:function(w){var x=i.get(this.query);if(x===undefined){w.el=this.el;switch(w.type){case"ToggleSwitch":x=new o(w);break;case"Text":x=new r(w);break;case"TextArea":x=new s(w);break;case"Select":x=new l(w);break;case"Radio":x=new p(w);break;case"Checkbox":x=new n(w);break;case"Camera":x=new g(w);break}x.id=this.query;x.type=w.type;i.push(x);return x}else{return i.get(this.query)}}});var t={};f.extend({ui:{overlay:function(){return new j()},loading:function(){return new h()},modal:function(w){return new b()}}},f);f.extend({_collection:[],get:function(x){var w;for(w=i._collection.length;w--;){if(i._collection[w].id===x){return i._collection[w]}}},push:function(w){this._collection.push(w)}},i);var a=function(w){w.e.stopPropagation();w.e.preventDefault()}}(Mootor));