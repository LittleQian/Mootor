(function(i){var z={radio:'<div moo-template="foreach: input"><div class="moo-ui-radio"><label><span class="moo-ui-radio-label" moo-template="text: this.label"></span><span class="moo-ui-radio-icon"> &nbsp;</span></label></div></div>',checkbox:'<div moo-template="foreach: input"><div class="moo-ui-checkbox"><label><span class="moo-ui-checkbox-label" moo-template="html: this.label"></span><span class="moo-ui-checkbox-icon"> &nbsp;</span></label></div></div>',overlay:"<div class='moo-overlay'></div>",loading:"<div class='moo-ui-loading'><div class='moo-ui-loading-block moo-loading-01'></div><div class='moo-ui-loading-block moo-loading-02'></div><div class='moo-ui-loading-block moo-loading-03'></div><div class='moo-ui-loading-block moo-loading-04'></div><div class='moo-ui-loading-block moo-loading-05'></div><div class='moo-ui-loading-block moo-loading-06'></div><div class='moo-ui-loading-block moo-loading-07'></div><div class='moo-ui-loading-block moo-loading-08'></div></div>",modal:"<div class='moo-ui-modal-container'><div class='moo-ui-modal-panel' moo-template='html: this.html'></div></div>",toggleswitch:"<div class='moo-ui-switch'><b><span class='moo-before'>I</span><span class='moo-button'>&nbsp;</span><span class='moo-after'>O</span></b></div>",text:'<span class="cleanbox">&times</span>',select:'<div class="moo-ui-select-container"><span class="moo-ui-select-text"></span><span class="moo-ui-select-link"> &#9660;</span></div>',camera:"<div class='moo-ui-image-container'><div class='moo-ui-image-panel'><ul class='moo-image-list'><li class='moo-image-wrapper'><div class='moo-image'></div></li></ul></div><header><a class='moo-ui-add-new' href='#takepic'>Take a picture</a><a class='moo-ui-add-filed' href='#choosepic'>Choose a picture</a><a class='moo-ui-delete' href='#delete'></a><a class='moo-ui-add-comment' href='#addcomment'></a></header></div>"},q=function(B){return B.split(" ").join("")},A=function(J){var H=J.template,I=J.self,B=[],E=document.createElement("div"),G=[],C=0,F=[],D;E.innerHTML=H;G=E.getElementsByTagName("*");for(C=G.length;C--;){if(G[C].getAttribute("moo-template")!==null){F=q(G[C].getAttribute("moo-template")).split(":");B.push({el:G[C],key:F[0],value:F[1]})}if((D=G[C].getAttribute("moo-foreach-index"))!==null){B[C].index=D}}if(d(B)===true){for(C=B.length;C--;){if(B[C].key==="foreach"){o(B[C],I)}}}else{for(C=B.length;C--;){switch(B[C].key){case"text":f(B[C],I);break;case"html":g(B[C],I);break}}}return E.innerHTML},d=function(C){var B;for(B=C.length;B--;){if(C[B].key==="foreach"){return true}}return false},o=function(B,J){var L=B.value,F=J.input.getElementsByTagName(L),C=0,K={},D=B.el.innerHTML,G=[],I,E=[],H=document.createElement("div");J.items=[];G=i(J.input).find(L);if(L==="input"){E=i(J.input).find("label")}for(C=0;C<G.length;C++){J.items.push({el:G[C],text:G[C].innerText});I=J.items[J.items.length-1];if(L==="input"){I.label=E[C]}if(I.el.value!==undefined){I.value=I.el.value}}B.el.innerHTML="";for(C=0;C<F.length;C++){K=document.createElement("div");K.innerHTML=D;K.firstChild.setAttribute("moo-foreach-index",C);K.firstChild.setAttribute("moo-foreach-value",J.items[C].value);K.innerHTML=A({template:K.innerHTML,self:J});H.appendChild(K.firstChild)}B.el.innerHTML=H.innerHTML},f=function(D,B){var C=D.index,F="",E="";if(D.value.indexOf("this.")>-1){F=D.value.replace("this.","");E=B.items[C][F];if(E!==undefined){if(typeof E==="string"){D.el.innerText=E}else{D.el.innerText=E.innerText}}}},g=function(D,B){var C=D.index,F="",E="";if(D.value.indexOf("this.")>-1){F=D.value.replace("this.","");E=B.items[C][F];if(typeof E==="string"){D.el.innerHTML=E}else{D.el.innerHTML=E.innerHTML}E.parentElement.removeChild(E)}};var n=function(){if(n.el===undefined){n._makeHTML({type:"overlay",object:n})}this.el=n.el;return this},c=function(){if(c.el===undefined){n._makeHTML({type:"modal",object:c})}this.el=c.el;return this},l=function(){if(l.el===undefined){n._makeHTML({type:"loading",object:l})}this.el=l.el;return this};l.prototype=n.prototype={show:function(){i(this.el).removeClass("moo-hidden")},hide:function(){i(this.el).setClass("moo-hidden")}};c.prototype={html:function(B){this.html=B;this.el.innerHTML=A({template:this.el.innerHTML,self:this})}};i.extend(n.prototype,c.prototype);i.extend({el:undefined,_makeHTML:function(C){var E=C.type,B=C.object,D=document.createElement("div");D.innerHTML=z[E];B.el=D.firstChild;i(B.el).setClass("moo-hidden");i(document.body).el.appendChild(B.el)}},n);var u=function(){};var s=function(B){this.input=B.el;i(this.input).hide();this._makeHTML();this._setTouchEvents();if(B.value){this.input.value=B.value}this.toggle(this.input.value);return this};s.prototype={_makeHTML:function(){var B;B=document.createElement("div");B.innerHTML=z.toggleswitch;this.el=B.firstChild;this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var D=this,E=i(D.el).find("b")[0],B=D.el.offsetWidth-32,C=0;D.x=0;D.isDragging=0;i(this.el).onTapEnd(function(F){D.toggle()});i(this.el).onSwipeRight(function(F){D._swipe=1});i(this.el).onSwipeLeft(function(F){D._swipe=-1});i(this.el).onDragMove(function(F){var G=D.x+(F.x-F.lastX);D.isDragging=1;i(D.el).removeClass("moo-on");i(D.el).removeClass("moo-off");F.e.stopPropagation();if((G<=B)&&(G>-4)){D.x=G;i(E).translateFx({x:D.x,y:0},{transitionDuration:0})}});i(this.el).onDragEnd(function(F){F.e.stopPropagation();i(E).cleanFx();if(D._swipe!==0&&F.time<400){if(D._swipe===1){D.toggle(1)}else{D.toggle(0)}}else{if(D.isDragging===1){D.isDragging=0;if(D.x<(B/2)){D.toggle(0)}else{D.toggle(1)}}}})},toggle:function(C){var B=i(this.el);if(C!==undefined){this.value=+C}else{if(this.value===0){this.value=1}else{this.value=0}}if(this.value===0){B.removeClass("moo-on");B.setClass("moo-off")}else{B.removeClass("moo-off");B.setClass("moo-on")}this.input.value=this.value;if(typeof this.onChange==="function"){this.onChange()}},on:function(B,C){if(B==="change"){this.onChange=C}}};var r=function(B){var C=0,D=this.pseudoItems=[];this.input=B.el;this.value=[];i(this.input).hide();this._makeHTML();D=i(this.container).find("div");for(C=0;C<D.length;C++){this.pseudoItems.push({el:D[C],value:D[C].value,mooSelectIndex:C})}this._setTouchEvents();if(B.value!==undefined){this.selectByValue(B.value)}return this};r.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=A({template:z.checkbox,self:this});this.container=i(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var B=this,C=0;for(C=0;C<this.pseudoItems.length;C++){i(this.pseudoItems[C].el).onTapEnd(function(G){var F=i(G.el),D=G.el.getAttribute("moo-foreach-index"),E=function(){if(F.hasClass("moo-active")){B.unselect(D)}else{B.select(D)}};if(i.context.userAgent==="android"){window.setTimeout(function(){E()},0)}else{E()}b(G)})}},select:function(B){if(this.value.indexOf(B)<0){this.value.push(B.toString());this.items[B].el.setAttribute("checked","checked");i(this.pseudoItems[B].el).setClass("moo-active")}},unselect:function(B){this.value.splice(this.value.indexOf(B),1);this.items[B].el.removeAttribute("checked","");i(this.pseudoItems[B].el).removeClass("moo-active")},unselectAll:function(){var B=0;for(B=this.items.length;B--;){this.unselect(B)}},selectByValue:function(D){var C,B;if(Object.prototype.toString.call(D)!=="[object Array]"){D=[D]}for(C=this.items.length;C--;){for(B=D.length;B--;){if(this.items[C].value===D[B]){i(this.pseudoItems[C].el).setClass("moo-active");this.select(C)}}}}};var t=function(B){var C=0,D=this.pseudoItems=[];this.input=B.el;i(this.input).hide();this._makeHTML();D=i(this.container).find("div");for(C=0;C<D.length;C++){this.pseudoItems.push({el:D[C],value:D[C].value,mooSelectIndex:C})}this._setTouchEvents();if(B.value!==undefined){this.selectByValue(B.value)}return this};t.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=A({template:z.radio,self:this});this.container=i(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var B=this,C=0;for(C=0;C<this.pseudoItems.length;C++){i(this.pseudoItems[C].el).onTapEnd(function(D){b(D);B.select(D.el.getAttribute("moo-foreach-index"))})}},select:function(C){var B=this,D;for(D=0;D<B.pseudoItems.length;D++){i(B.pseudoItems[D].el).removeClass("moo-active");B.pseudoItems[D].el.removeAttribute("checked","checked")}i(B.pseudoItems[C].el).setClass("moo-active");this.value=this.items[C].value;this.selectedIndex=C;this.input.selectedIndex=C;this.items[this.selectedIndex].el.setAttribute("checked","checked")},selectByValue:function(C){var B;for(B=this.items.length;B--;){if(this.items[B].value===C){this.select(B)}}}};var p=function(B){var C=0,D=this.pseudoItems=[];this.y=0;this.input=B.el;this._visibility="hidden";this._makeHTML();this._setTouchEvents();D=i(this.input).find("option");for(C=0;C<D.length;C++){this.pseudoItems.push({el:D[C],mooSelectIndex:C})}if(B.value!==undefined){this.selectByValue(B.value)}this.select(0);return this};p.prototype={_makeHTML:function(){var D=document.createElement("div"),C=z.select,B=this.input.parentElement;D.innerHTML=A({template:C,self:this});this.el=D.firstChild;this.el.parentElement.insertBefore(this.input);B.appendChild(D);this.box=i(this.el).find(".moo-ui-select-menu")[0];this.textspan=i(this.el).find(".moo-ui-select-text")[0]},_setTouchEvents:function(){var B=this;i(this.input).onTapEnd(function(C){if(B._visibility!=="visible"){B.input.focus();B._visibility="visible"}});i(this.input).on("blur",function(){B._visibility="hidden"});i(this.input).on("change",function(){B.select(B.input.selectedIndex)});i(this.el).onDragStart(b)},select:function(C){var B=this;window.setTimeout(function(){i(B.box).hide();B._visibility="hidden"},100);this.value=this.pseudoItems[C].el.value;this.selectedIndex=C;this.input.selectedIndex=C;i(this.textspan).html(this.pseudoItems[C].el.innerText)},selectByValue:function(C){var B;for(B=this.pseudoItems.length;B--;){if(this.pseudoItems[B].el.value===C){this.select(B)}}}};var y=false,v=function(C){var B=this;this.el=this.input=C.el;if(C.value!==undefined){this.el.value=C.value}this.value=B.el.value;this._makeHTML();i(this.el).onDragStart(b);i(this.el).onTapEnd(function(D){D.el.focus();b(D)});i(this.cleanbox).onTapEnd(function(){B.clean()});this.el.onblur=function(){window.scrollTo(0,0)};return this};v.focused=false;v.prototype={_makeHTML:function(){var D,C=this.el.parentElement,B=this;this.cleanbox=document.createElement("div");this.cleanbox.innerHTML=z.text;D=document.createElement("div");i(D).setClass("moo-ui-text");D.appendChild(this.cleanbox);D.appendChild(this.input);i(this.input).on("keyup",function(E){B.value=B.input.value;if(typeof B.onChange==="function"){B.onChange()}});C.appendChild(D)},clean:function(){this.input.value="";this.input.focus()},on:function(B,C){if(B==="change"){this.onChange=C}}};var w=function(C){var B=this;this.el=this.input=C.el;if(C.value!==undefined){this.el.innerHTML=C.value}this.value=B.el.innerHTML;this._makeHTML();i(this.el).onDragStart(b);i(this.el).onTapEnd(function(D){D.el.focus();b(D)});return this};w.prototype={_makeHTML:function(){var D,C=this.el.parentElement,B=this;i(this.input).on("keyup",function(E){B.value=B.input.value});D=document.createElement("div");i(D).setClass("moo-ui-textarea");D.appendChild(this.input);C.appendChild(D)}};var k=function(B){this.input=B.el;this.position=B.position;this.count=0;k._makeHTML(B,this);k._setTouchEvents(this);k._initProperties(this,B);if(B.value!==undefined){this.value=B.value}else{this.value=[]}return this};k.prototype={show:function(){if(typeof this.onShowBox==="function"){this.onShowBox()}i(this.el).show();this._visibility="visible"},hide:function(){i(this.el).hide();this._visibility="hidden"},onShowBox:function(B){this.onShowBox=B},onCamera:function(B){this.onCamera=B},onSuccess:function(B){this.onSuccess=B},onFail:function(B){this.onFail=B},onChange:function(B){this.onChange=B},push:function(G){var B=document.createElement("div"),F,D=this,C,E;B.innerHTML=this.imageWrapper.outerHTML;C=i(B).find(".moo-image");F=C[0];F.setAttribute("moo-index",this.count);C=i(D.imageList).find("li");for(E=C.length;E--;){i(C[E].firstChild).removeClass("moo-active")}i(F).setClass("moo-active");D.itemSelected=this.count;i(F).onTapEnd(function(K){var J=i(K.el),I,H=i(D.imageList).find("li");if(J.hasClass("moo-active")===false){for(I=H.length;I--;){i(H[I].firstChild).removeClass("moo-active")}i(K.el).setClass("moo-active");D.itemSelected=K.el.getAttribute("moo-index")}});F.appendChild(G);this.value.push(G.getAttribute("src"));i(B.firstChild).show();this.imageList.appendChild(B.firstChild);i(this.el).removeClass("moo-empty");this.count++},clear:function(){var B=i(this.imageList).find("li"),C=0;for(C=B.length;C--;){this.imageList.removeChild(B[C])}this.count=0;this.value=[]},removeItem:function(C){var B=i(this.imageList).find("li"),D=0;console.log("remove item!");this.imageList.removeChild(B[D]);this.value.splice(C,1);this.count=B.length-1;if(typeof this.onChange==="function"){this.onChange(this,C)}i(B[this.count]).setClass("moo-active");this.itemSelected=this.count}};i.extend({_makeHTML:function(D,C){var E=document.createElement("div"),B;E.innerHTML=z.camera;C.el=E.firstChild;B=i(C.el);B.setClass("moo-empty");if(C.position==="top"){B.setClass("moo-top")}else{if(C.position==="bottom"){B.setClass("moo-bottom")}}C.takeButton=B.find(".moo-ui-add-new")[0];C.chooseButton=B.find(".moo-ui-add-filed")[0];if(D.labelTakeButton!==undefined){C.takeButton.innerHTML=D.labelTakeButton}if(D.labelChooseButton!==undefined){C.chooseButton.innerHTML=D.labelChooseButton}C.imageWrapper=B.find(".moo-image-wrapper")[0];C.imageList=B.find(".moo-image-list")[0];B.hide();C._visibility="hidden";C.input.appendChild(C.el);i(C.imageWrapper).hide()},_setTouchEvents:function(B){i(B.input).onTapEnd(function(){if(B._visibility==="hidden"){B.show()}else{B.hide()}});i(B.el).onTapEnd(function(){B.hide()});i(B.takeButton).onTapEnd(function(){k.camera(B)});i(B.chooseButton).onTapEnd(function(){k.camera(B,"album")})},_initProperties:function(B,C){B.quality=B.quality?B.quality:50;B.width=B.width?B.width:1024;B.height=B.height?B.height:768},camera:function(B,C){var D,E;if(typeof B.onCamera==="function"){B.onCamera()}if(B.disabled!==true){if(window.Camera!==undefined){if(C==="album"){D=window.Camera.PictureSourceType.SAVEDPHOTOALBUM}E=function(F){B.onSuccess(F)};navigator.camera.getPicture(E,B.onFail,{quality:B.quality,destinationType:window.Camera.DestinationType.FILE_URI,sourceType:D,targetWidth:B.width,targetHeight:B.height})}else{console.log("Not camera! using sample pic");B.onSuccess("img/temp/samplepic.jpg")}}}},k);var e=function(B){this.input=B.el;this.sourceType=B.sourceType;e._setTouchEvents(this);e._initProperties(this,B);if(B.value!==undefined){this.value=B.value}else{this.value=[]}return this};e.prototype={onCamera:function(B){this.onCamera=B},onSuccess:function(B){this.onSuccess=B},onFail:function(B){this.onFail=B},onChange:function(B){this.onChange=B},};i.extend({_setTouchEvents:function(B){if(B.sourceType==="album"){i(B.input).onTapEnd(function(){k.camera(B,"album")})}else{i(B.input).onTapEnd(function(){k.camera(B)})}},_initProperties:function(B,C){B.quality=B.quality?B.quality:50;B.width=B.width?B.width:1024;B.height=B.height?B.height:768},camera:function(B,C){var D,E;if(typeof B.onCamera==="function"){B.onCamera()}if(B.disabled!==true){if(window.Camera!==undefined){if(C==="album"){D=window.Camera.PictureSourceType.SAVEDPHOTOALBUM}E=function(F){B.onSuccess(F)};navigator.camera.getPicture(E,B.onFail,{quality:B.quality,destinationType:window.Camera.DestinationType.FILE_URI,sourceType:D,targetWidth:B.width,targetHeight:B.height})}else{console.log("Not camera! using sample pic");B.onSuccess("img/temp/samplepic.jpg")}}}},e);var h=function(C){var B=this;this.el=C.el;h._setTouchEvents(B);if(C.key!==undefined){B.key=C.key}else{B.key=""}B.onLoad=C.onLoad;h._includeScript(B.key,function(){h._API=google.maps;h._initProperties(B,C);h._initMap(B,C);if(typeof B.onLoad==="function"){B.onLoad()}return B})};h.prototype={addMarker:function(C){var B=new j(C,this.map);B.setMap(this);return this}};var j=function(C,E){var D,B=this;this.lat=C.lat;this.lon=C.lon;this.html=C.html;this._APIMarker=new h._API.Marker();this._APIMarker.setPosition(new h._API.LatLng(this.lat,this.lon));D=new h._API.InfoWindow({content:B.html});h._API.event.addListener(this._APIMarker,"click",function(){D.open(E,B._APIMarker)});return this};j.prototype={setMap:function(B){this._APIMarker.setMap(B.map)}};i.extend({_setTouchEvents:function(B){i(B.el).on("touchmove",function(C){C.stopPropagation()})},_initProperties:function(B,C){B.width=C.width?C.width:"100%";B.height=C.height?C.height:"100%";B.el.setAttribute("style","width:"+B.width+";height:"+B.height);B.zoom=C.zoom?C.zoom:13;B.center=C.center?C.center:[-34.599567,-58.372553];B.mapType=C.mapType?C.mapType:h._API.MapTypeId.ROADMAP},_includeScript:function(B,C){i._UIMapCallbacks=C;a(h._APIScript+"&key="+B)},_initMap:function(B){var C;C={zoom:B.zoom,center:new h._API.LatLng(B.center[0],B.center[1]),mapTypeId:B.mapType};h._API.Map.prototype.markers=new Array();h._API.Map.prototype.getMarkers=function(){return this.markers};h._API.Map.prototype.clearMarkers=function(){for(var D=0;D<this.markers.length;D++){this.markers[D].setMap(null)}this.markers=new Array()};B.map=new h._API.Map(B.el,C)},_APIScript:"https://maps.googleapis.com/maps/api/js?sensor=false&callback=$._UIMapCallbacks"},h);var a=function(B,D){var C=document.createElement("script");C.type="text/javascript";C.setAttribute("src",B);C.onload=D;document.body.appendChild(C)};var m=function(){};i.extend({ui:function(B){var C=m.get(this.query);if(C===undefined){B.el=this.el;switch(B.type){case"ToggleSwitch":C=new s(B);break;case"Text":C=new v(B);break;case"TextArea":C=new w(B);break;case"Select":C=new p(B);break;case"Radio":C=new t(B);break;case"Checkbox":C=new r(B);break;case"Camera":C=new k(B);break;case"SimpleCamera":C=new e(B);break;case"Map":C=new h(B);break}C.id=this.query;C.type=B.type;m.push(C);return C}else{return m.get(this.query)}}});var x={};i.extend({ui:{overlay:function(){return new n()},loading:function(){return new l()},modal:function(B){return new c()}}},i);i(document).ready(function(){var B=new n(),C=new l();i.extend({loadingScreen:{show:function(){B.show();C.show()},hide:function(){B.hide();C.hide()}}},i)});i.extend({_collection:[],get:function(C){var B;for(B=m._collection.length;B--;){if(m._collection[B].id===C){return m._collection[B]}}},push:function(B){this._collection.push(B)}},m);var b=function(B){B.e.stopPropagation();B.e.preventDefault()}}(Mootor));