(function(f){var w={radio:'<div moo-template="foreach: input"><div class="moo-ui-radio"><label><span class="moo-ui-radio-label" moo-template="text: this.label"></span><span class="moo-ui-radio-icon"> &nbsp;</span></label></div></div>',checkbox:'<div moo-template="foreach: input"><div class="moo-ui-checkbox"><label><span class="moo-ui-checkbox-label" moo-template="html: this.label"></span><span class="moo-ui-checkbox-icon"> &nbsp;</span></label></div></div>',overlay:"<div class='moo-overlay'></div>",loading:"<div class='moo-ui-loading'><div class='moo-ui-loading-block moo-loading-01'></div><div class='moo-ui-loading-block moo-loading-02'></div><div class='moo-ui-loading-block moo-loading-03'></div><div class='moo-ui-loading-block moo-loading-04'></div><div class='moo-ui-loading-block moo-loading-05'></div><div class='moo-ui-loading-block moo-loading-06'></div><div class='moo-ui-loading-block moo-loading-07'></div><div class='moo-ui-loading-block moo-loading-08'></div></div>",modal:"<div class='moo-ui-modal-container'><div class='moo-ui-modal-panel' moo-template='html: this.html'></div></div>",toggleswitch:"<div class='moo-ui-switch'><b><span class='moo-before'>I</span><span class='moo-button'>&nbsp;</span><span class='moo-after'>O</span></b></div>",text:'<span class="cleanbox">&times</span>',select:'<div class="moo-ui-select-container"><span class="moo-ui-select-text"></span><span class="moo-ui-select-link"> &#9660;</span><div class="moo-ui-select-menu" style="height:217px;display:none"><div class="moo-ui-select-wrapper"><ul class="moo-ui-select-list" moo-template="foreach: option"><li moo-template="text: this.text"></li></ul></div></div></div>',camera:"<div class='moo-ui-image-container'><header><a class='moo-ui-add-new' href='#takepic'>Take a picture</a><a class='moo-ui-add-filed' href='#choosepic'>Choose a picture</a><a class='moo-ui-delete' href='#delete'></a><a class='moo-ui-add-comment' href='#addcomment'></a></header><div class='moo-ui-image-panel'><ul class='moo-image-list'><li class='moo-image-wrapper'><div class='moo-image'></div></li></ul></div></div>"},n=function(y){return y.split(" ").join("")},x=function(G){var E=G.template,F=G.self,y=[],B=document.createElement("div"),D=[],z=0,C=[],A;B.innerHTML=E;D=B.getElementsByTagName("*");for(z=D.length;z--;){if(D[z].getAttribute("moo-template")!==null){C=n(D[z].getAttribute("moo-template")).split(":");y.push({el:D[z],key:C[0],value:C[1]})}if((A=D[z].getAttribute("moo-foreach-index"))!==null){y[z].index=A}}if(c(y)===true){for(z=y.length;z--;){if(y[z].key==="foreach"){l(y[z],F)}}}else{for(z=y.length;z--;){switch(y[z].key){case"text":d(y[z],F);break;case"html":e(y[z],F);break}}}return B.innerHTML},c=function(z){var y;for(y=z.length;y--;){if(z[y].key==="foreach"){return true}}return false},l=function(y,G){var I=y.value,C=G.input.getElementsByTagName(I),z=0,H={},A=y.el.innerHTML,D=[],F,B=[],E=document.createElement("div");G.items=[];D=f(G.input).find(I);if(I==="input"){B=f(G.input).find("label")}for(z=0;z<D.length;z++){G.items.push({el:D[z],text:D[z].innerText});F=G.items[G.items.length-1];if(I==="input"){F.label=B[z]}if(F.el.value!==undefined){F.value=F.el.value}}y.el.innerHTML="";for(z=0;z<C.length;z++){H=document.createElement("div");H.innerHTML=A;H.firstChild.setAttribute("moo-foreach-index",z);H.firstChild.setAttribute("moo-foreach-value",G.items[z].value);H.innerHTML=x({template:H.innerHTML,self:G});E.appendChild(H.firstChild)}y.el.innerHTML=E.innerHTML},d=function(A,y){var z=A.index,C="",B="";if(A.value.indexOf("this.")>-1){C=A.value.replace("this.","");B=y.items[z][C];if(B!==undefined){if(typeof B==="string"){A.el.innerText=B}else{A.el.innerText=B.innerText}}}},e=function(A,y){var z=A.index,C="",B="";if(A.value.indexOf("this.")>-1){C=A.value.replace("this.","");B=y.items[z][C];if(typeof B==="string"){A.el.innerHTML=B}else{A.el.innerHTML=B.innerHTML}B.parentElement.removeChild(B)}};var k=function(){if(k.el===undefined){k._makeHTML({type:"overlay",object:k})}this.el=k.el;return this},b=function(){if(b.el===undefined){k._makeHTML({type:"modal",object:b})}this.el=b.el;return this},h=function(){if(h.el===undefined){k._makeHTML({type:"loading",object:h})}this.el=h.el;return this};h.prototype=k.prototype={show:function(){f(this.el).removeClass("moo-hidden")},hide:function(){f(this.el).setClass("moo-hidden")}};b.prototype={html:function(y){this.html=y;this.el.innerHTML=x({template:this.el.innerHTML,self:this})}};f.extend(k.prototype,b.prototype);f.extend({el:undefined,_makeHTML:function(z){var B=z.type,y=z.object,A=document.createElement("div");A.innerHTML=w[B];y.el=A.firstChild;f(y.el).setClass("moo-hidden");f(document.body).el.appendChild(y.el)}},k);var r=function(){};var p=function(y){this.input=y.el;f(this.input).hide();this._makeHTML();this._setTouchEvents();if(y.value){this.input.value=y.value}this.toggle(this.input.value);return this};p.prototype={_makeHTML:function(){var y;y=document.createElement("div");y.innerHTML=w.toggleswitch;this.el=y.firstChild;this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var A=this,B=f(A.el).find("b")[0],y=A.el.offsetWidth-32,z=0;A.x=0;A.isDragging=0;f(this.el).onTapEnd(function(C){A.toggle()});f(this.el).onSwipeRight(function(C){A._swipe=1});f(this.el).onSwipeLeft(function(C){A._swipe=-1});f(this.el).onDragMove(function(C){var D=A.x+(C.x-C.lastX);A.isDragging=1;f(A.el).removeClass("moo-on");f(A.el).removeClass("moo-off");C.e.stopPropagation();if((D<=y)&&(D>-4)){A.x=D;f(B).translateFx({x:A.x,y:0},{transitionDuration:0})}});f(this.el).onDragEnd(function(C){C.e.stopPropagation();f(B).cleanFx();if(A._swipe!==0&&C.time<400){if(A._swipe===1){A.toggle(1)}else{A.toggle(0)}}else{if(A.isDragging===1){A.isDragging=0;if(A.x<(y/2)){A.toggle(0)}else{A.toggle(1)}}}})},toggle:function(z){var y=f(this.el);if(z!==undefined){this.value=+z}else{if(this.value===0){this.value=1}else{this.value=0}}if(this.value===0){y.removeClass("moo-on");y.setClass("moo-off")}else{y.removeClass("moo-off");y.setClass("moo-on")}this.input.value=this.value;if(typeof this.onChange==="function"){this.onChange()}},on:function(y,z){if(y==="change"){this.onChange=z}}};var o=function(y){var z=0,A=this.pseudoItems=[];this.input=y.el;this.value=[];f(this.input).hide();this._makeHTML();A=f(this.container).find("div");for(z=0;z<A.length;z++){this.pseudoItems.push({el:A[z],value:A[z].value,mooSelectIndex:z})}this._setTouchEvents();if(y.value!==undefined){this.selectByValue(y.value)}return this};o.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=x({template:w.checkbox,self:this});this.container=f(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var y=this,z=0;for(z=0;z<this.pseudoItems.length;z++){f(this.pseudoItems[z].el).onTapEnd(function(B){var A=f(B.el);a(B);if(A.hasClass("moo-active")){y.unselect(B.el.getAttribute("moo-foreach-index"))}else{y.select(B.el.getAttribute("moo-foreach-index"))}})}},select:function(y){if(this.value.indexOf(y)<0){this.value.push(y.toString());this.items[y].el.setAttribute("checked","checked");f(this.pseudoItems[y].el).setClass("moo-active")}},unselect:function(y){this.value.splice(this.value.indexOf(y),1);this.items[y].el.removeAttribute("checked","");f(this.pseudoItems[y].el).removeClass("moo-active")},unselectAll:function(){var y=0;for(y=this.items.length;y--;){this.unselect(y)}},selectByValue:function(A){var z,y;if(Object.prototype.toString.call(A)!=="[object Array]"){A=[A]}for(z=this.items.length;z--;){for(y=A.length;y--;){if(this.items[z].value===A[y]){f(this.pseudoItems[z].el).setClass("moo-active");this.select(z)}}}}};var q=function(y){var z=0,A=this.pseudoItems=[];this.input=y.el;f(this.input).hide();this._makeHTML();A=f(this.container).find("div");for(z=0;z<A.length;z++){this.pseudoItems.push({el:A[z],value:A[z].value,mooSelectIndex:z})}this._setTouchEvents();if(y.value!==undefined){this.selectByValue(y.value)}return this};q.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=x({template:w.radio,self:this});this.container=f(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var y=this,z=0;for(z=0;z<this.pseudoItems.length;z++){f(this.pseudoItems[z].el).onTapEnd(function(A){a(A);y.select(A.el.getAttribute("moo-foreach-index"))})}},select:function(z){var y=this,A;for(A=0;A<y.pseudoItems.length;A++){f(y.pseudoItems[A].el).removeClass("moo-active");y.pseudoItems[A].el.removeAttribute("checked","checked")}f(y.pseudoItems[z].el).setClass("moo-active");this.value=this.items[z].value;this.selectedIndex=z;this.input.selectedIndex=z;this.items[this.selectedIndex].el.setAttribute("checked","checked")},selectByValue:function(z){var y;for(y=this.items.length;y--;){if(this.items[y].value===z){this.select(y)}}}};var m=function(y){var z=0,A=this.pseudoItems=[];this.y=0;this.input=y.el;this.position=y.position;f(this.input).hide();this._visibility="hidden";this._makeHTML();this._setTouchEvents();A=f(this.ul).find("li");for(z=0;z<A.length;z++){this.pseudoItems.push({el:A[z],mooSelectIndex:z})}if(y.value!==undefined){this.selectByValue(y.value)}return this};m.prototype={_makeHTML:function(){var z=document.createElement("div"),y=w.select;z.innerHTML=x({template:y,self:this});this.el=z.firstChild;if(this.position==="top"){f(this.el).setClass("moo-top")}else{if(this.position==="bottom"){f(this.el).setClass("moo-bottom")}}this.input.parentElement.appendChild(this.el);this.ul=f(this.el).find("ul")[0];this.box=f(this.el).find(".moo-ui-select-menu")[0];this.textspan=f(this.el).find(".moo-ui-select-text")[0]},_setTouchEvents:function(){var y=this;f(this.el).onTapEnd(function(z){if(y._visibility!=="visible"){f(y.input).show();y.input.focus();y._visibility="visible"}else{y.input.blur();f(y.input).hide();y._visibility="hidden"}});f(this.input).on("blur",function(){f(y.input).hide();y._visibility="hidden"});f(this.el).onDragStart(a)},select:function(z){var y=this;window.setTimeout(function(){f(y.box).hide();y._visibility="hidden"},100);this.value=this.items[z].value;this.selectedIndex=z;this.input.selectedIndex=z;f(this.textspan).html(this.pseudoItems[z].el.innerHTML)},selectByValue:function(z){var y;for(y=this.items.length;y--;){if(this.items[y].value===z){this.select(y)}}}};var v=false,s=function(z){var y=this;this.el=this.input=z.el;if(z.value!==undefined){this.el.value=z.value}this.value=y.el.value;this._makeHTML();f(this.el).onDragStart(a);f(this.el).onTapEnd(function(A){A.el.focus();a(A)});f(this.cleanbox).onTapEnd(function(){y.clean()});this.el.onblur=function(){window.scrollTo(0,0)};return this};s.focused=false;s.prototype={_makeHTML:function(){var A,z=this.el.parentElement,y=this;this.cleanbox=document.createElement("div");this.cleanbox.innerHTML=w.text;A=document.createElement("div");f(A).setClass("moo-ui-text");A.appendChild(this.cleanbox);A.appendChild(this.input);f(this.input).on("keyup",function(B){y.value=y.input.value;if(typeof y.onChange==="function"){y.onChange()}});z.appendChild(A)},clean:function(){this.input.value="";this.input.focus()},on:function(y,z){if(y==="change"){this.onChange=z}}};var t=function(z){var y=this;this.el=this.input=z.el;if(z.value!==undefined){this.el.innerHTML=z.value}this.value=y.el.innerHTML;this._makeHTML();f(this.el).onDragStart(a);f(this.el).onTapEnd(function(A){A.el.focus();a(A)});return this};t.prototype={_makeHTML:function(){var A,z=this.el.parentElement,y=this;f(this.input).on("keyup",function(B){y.value=y.input.value});A=document.createElement("div");f(A).setClass("moo-ui-textarea");A.appendChild(this.input);z.appendChild(A)}};var g=function(y){this.input=y.el;this.position=y.position;this.count=0;g._makeHTML(y,this);g._setTouchEvents(this);g._initProperties(this,y);if(y.value!==undefined){this.value=y.value}else{this.value=[]}return this};g.prototype={show:function(){if(typeof this.onShowBox==="function"){this.onShowBox()}f(this.el).show();this._visibility="visible"},hide:function(){f(this.el).hide();this._visibility="hidden"},onShowBox:function(y){this.onShowBox=y},onCamera:function(y){this.onCamera=y},onSuccess:function(y){this.onSuccess=y},onFail:function(y){this.onFail=y},push:function(C){var y=document.createElement("div"),B,A=this,z;y.innerHTML=this.imageWrapper.outerHTML;z=f(y).find(".moo-image");B=z[0];B.setAttribute("moo-index",this.count);z=f(A.imageList).find("li");for(i=z.length;i--;){f(z[i].firstChild).removeClass("moo-active")}f(B).setClass("moo-active");A.itemSelected=this.count;f(B).onTapEnd(function(G){var F=f(G.el),E,D=f(A.imageList).find("li");if(F.hasClass("moo-active")===false){for(E=D.length;E--;){f(D[E].firstChild).removeClass("moo-active")}f(G.el).setClass("moo-active");A.itemSelected=G.el.getAttribute("moo-index")}});B.appendChild(C);this.value.push(C.getAttribute("src"));f(y.firstChild).show();this.imageList.appendChild(y.firstChild);f(this.el).removeClass("moo-empty");this.count++},clear:function(){var y=f(this.imageList).find("li"),z=0;for(z=y.length;z--;){this.imageList.removeChild(y[z])}this.count=0;this.value=[]}};f.extend({_makeHTML:function(A,z){var B=document.createElement("div"),y;B.innerHTML=w.camera;z.el=B.firstChild;y=f(z.el);y.setClass("moo-empty");if(z.position==="top"){y.setClass("moo-top")}else{if(z.position==="bottom"){y.setClass("moo-bottom")}}z.takeButton=y.find(".moo-ui-add-new")[0];z.chooseButton=y.find(".moo-ui-add-filed")[0];z.imageWrapper=y.find(".moo-image-wrapper")[0];z.imageList=y.find(".moo-image-list")[0];y.hide();z._visibility="hidden";z.input.appendChild(z.el);f(z.imageWrapper).hide()},_setTouchEvents:function(y){f(y.input).onTapEnd(function(){if(y._visibility==="hidden"){y.show()}else{y.hide()}});f(y.el).onTapEnd(function(){y.hide()});f(y.takeButton).onTapEnd(function(){g.camera(y)});f(y.chooseButton).onTapEnd(function(){g.camera(y,"album")})},_initProperties:function(y,z){y.quality=y.quality?y.quality:50;y.width=y.width?y.width:1024;y.height=y.height?y.height:768},camera:function(y,z){var A,B;if(typeof y.onCamera==="function"){y.onCamera()}if(y.disabled!==true){if(window.Camera!==undefined){if(z==="album"){A=window.Camera.PictureSourceType.SAVEDPHOTOALBUM}B=function(C){y.onSuccess(C)};navigator.camera.getPicture(B,y.onFail,{quality:y.quality,destinationType:window.Camera.DestinationType.FILE_URI,sourceType:A,targetWidth:y.width,targetHeight:y.height})}else{console.log("Not camera! using sample pic");y.onSuccess("img/temp/samplepic.jpg")}}}},g);var j=function(){};f.extend({ui:function(y){var z=j.get(this.query);if(z===undefined){y.el=this.el;switch(y.type){case"ToggleSwitch":z=new p(y);break;case"Text":z=new s(y);break;case"TextArea":z=new t(y);break;case"Select":z=new m(y);break;case"Radio":z=new q(y);break;case"Checkbox":z=new o(y);break;case"Camera":z=new g(y);break}z.id=this.query;z.type=y.type;j.push(z);return z}else{return j.get(this.query)}}});var u={};f.extend({ui:{overlay:function(){return new k()},loading:function(){return new h()},modal:function(y){return new b()}}},f);f.extend({_collection:[],get:function(z){var y;for(y=j._collection.length;y--;){if(j._collection[y].id===z){return j._collection[y]}}},push:function(y){this._collection.push(y)}},j);var a=function(y){y.e.stopPropagation();y.e.preventDefault()}}(Mootor));