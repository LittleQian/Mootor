(function(j){var A={radio:'<div moo-template="foreach: input"><div class="moo-ui-radio"><label><span class="moo-ui-radio-label" moo-template="text: this.label"></span><span class="moo-ui-radio-icon"> &nbsp;</span></label></div></div>',checkbox:'<div moo-template="foreach: input"><div class="moo-ui-checkbox"><label><span class="moo-ui-checkbox-label" moo-template="html: this.label"></span><span class="moo-ui-checkbox-icon"> &nbsp;</span></label></div></div>',overlay:"<div class='moo-overlay'></div>",loading:"<div class='moo-ui-loading'><div class='moo-ui-loading-block moo-loading-01'></div><div class='moo-ui-loading-block moo-loading-02'></div><div class='moo-ui-loading-block moo-loading-03'></div><div class='moo-ui-loading-block moo-loading-04'></div><div class='moo-ui-loading-block moo-loading-05'></div><div class='moo-ui-loading-block moo-loading-06'></div><div class='moo-ui-loading-block moo-loading-07'></div><div class='moo-ui-loading-block moo-loading-08'></div></div>",modal:"<div class='moo-ui-modal-container'><div class='moo-ui-modal-panel' moo-template='html: this.html'></div></div>",toggleswitch:"<div class='moo-ui-switch'><b><span class='moo-before'>I</span><span class='moo-button'>&nbsp;</span><span class='moo-after'>O</span></b></div>",text:'<span class="cleanbox">&times</span>',select:'<div class="moo-ui-select-container"><span class="moo-ui-select-text"></span><span class="moo-ui-select-link"> &#9660;</span><div class="moo-ui-select-menu" style="height:217px;display:none"><div class="moo-ui-select-wrapper"></div></div></div>',camera:"<div class='moo-ui-image-container'><div class='moo-ui-image-panel'><ul class='moo-image-list'><li class='moo-image-wrapper'><div class='moo-image'></div></li></ul></div><header><a class='moo-ui-add-new' href='#takepic'>Take a picture</a><a class='moo-ui-add-filed' href='#choosepic'>Choose a picture</a><a class='moo-ui-delete' href='#delete'></a><a class='moo-ui-add-comment' href='#addcomment'></a></header></div>"},r=function(C){return C.split(" ").join("")},B=function(K){var I=K.template,J=K.self,C=[],F=document.createElement("div"),H=[],D=0,G=[],E;F.innerHTML=I;H=F.getElementsByTagName("*");for(D=H.length;D--;){if(H[D].getAttribute("moo-template")!==null){G=r(H[D].getAttribute("moo-template")).split(":");C.push({el:H[D],key:G[0],value:G[1]})}if((E=H[D].getAttribute("moo-foreach-index"))!==null){C[D].index=E}}if(d(C)===true){for(D=C.length;D--;){if(C[D].key==="foreach"){p(C[D],J)}}}else{for(D=C.length;D--;){switch(C[D].key){case"text":f(C[D],J);break;case"html":g(C[D],J);break}}}return F.innerHTML},d=function(D){var C;for(C=D.length;C--;){if(D[C].key==="foreach"){return true}}return false},p=function(C,K){var M=C.value,G=K.input.getElementsByTagName(M),D=0,L={},E=C.el.innerHTML,H=[],J,F=[],I=document.createElement("div");K.items=[];H=j(K.input).find(M);if(M==="input"){F=j(K.input).find("label")}for(D=0;D<H.length;D++){K.items.push({el:H[D],text:H[D].innerText});J=K.items[K.items.length-1];if(M==="input"){J.label=F[D]}if(J.el.value!==undefined){J.value=J.el.value}}C.el.innerHTML="";for(D=0;D<G.length;D++){L=document.createElement("div");L.innerHTML=E;L.firstChild.setAttribute("moo-foreach-index",D);L.firstChild.setAttribute("moo-foreach-value",K.items[D].value);L.innerHTML=B({template:L.innerHTML,self:K});I.appendChild(L.firstChild)}C.el.innerHTML=I.innerHTML},f=function(E,C){var D=E.index,G="",F="";if(E.value.indexOf("this.")>-1){G=E.value.replace("this.","");F=C.items[D][G];if(F!==undefined){if(typeof F==="string"){E.el.innerText=F}else{E.el.innerText=F.innerText}}}},g=function(E,C){var D=E.index,G="",F="";if(E.value.indexOf("this.")>-1){G=E.value.replace("this.","");F=C.items[D][G];if(typeof F==="string"){E.el.innerHTML=F}else{E.el.innerHTML=F.innerHTML}F.parentElement.removeChild(F)}};var o=function(){if(o.el===undefined){o._makeHTML({type:"overlay",object:o})}this.el=o.el;return this},c=function(){if(c.el===undefined){o._makeHTML({type:"modal",object:c})}this.el=c.el;return this},m=function(){if(m.el===undefined){o._makeHTML({type:"loading",object:m})}this.el=m.el;return this};m.prototype=o.prototype={show:function(){j(this.el).removeClass("moo-hidden")},hide:function(){j(this.el).setClass("moo-hidden")}};c.prototype={html:function(C){this.html=C;this.el.innerHTML=B({template:this.el.innerHTML,self:this})}};j.extend(o.prototype,c.prototype);j.extend({el:undefined,_makeHTML:function(D){var F=D.type,C=D.object,E=document.createElement("div");E.innerHTML=A[F];C.el=E.firstChild;j(C.el).setClass("moo-hidden");j(document.body).el.appendChild(C.el)}},o);var v=function(){};var t=function(C){this.input=C.el;j(this.input).hide();this._makeHTML();this._setTouchEvents();if(C.value){this.input.value=C.value}this.toggle(this.input.value);return this};t.prototype={_makeHTML:function(){var C;C=document.createElement("div");C.innerHTML=A.toggleswitch;this.el=C.firstChild;this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var E=this,F=j(E.el).find("b")[0],C=E.el.offsetWidth-32,D=0;E.x=0;E.isDragging=0;j(this.el).onTapEnd(function(G){E.toggle()});j(this.el).onSwipeRight(function(G){E._swipe=1});j(this.el).onSwipeLeft(function(G){E._swipe=-1});j(this.el).onDragMove(function(G){var H=E.x+(G.x-G.lastX);E.isDragging=1;j(E.el).removeClass("moo-on");j(E.el).removeClass("moo-off");G.e.stopPropagation();if((H<=C)&&(H>-4)){E.x=H;j(F).translateFx({x:E.x,y:0},{transitionDuration:0})}});j(this.el).onDragEnd(function(G){G.e.stopPropagation();j(F).cleanFx();if(E._swipe!==0&&G.time<400){if(E._swipe===1){E.toggle(1)}else{E.toggle(0)}}else{if(E.isDragging===1){E.isDragging=0;if(E.x<(C/2)){E.toggle(0)}else{E.toggle(1)}}}})},toggle:function(D){var C=j(this.el);if(D!==undefined){this.value=+D}else{if(this.value===0){this.value=1}else{this.value=0}}if(this.value===0){C.removeClass("moo-on");C.setClass("moo-off")}else{C.removeClass("moo-off");C.setClass("moo-on")}this.input.value=this.value;if(typeof this.onChange==="function"){this.onChange()}},on:function(C,D){if(C==="change"){this.onChange=D}}};var s=function(C){var D=0,E=this.pseudoItems=[];this.input=C.el;this.value=[];j(this.input).hide();this._makeHTML();E=j(this.container).find("div");for(D=0;D<E.length;D++){this.pseudoItems.push({el:E[D],value:E[D].value,mooSelectIndex:D})}this._setTouchEvents();if(C.value!==undefined){this.selectByValue(C.value)}return this};s.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=B({template:A.checkbox,self:this});this.container=j(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var C=this,D=0;for(D=0;D<this.pseudoItems.length;D++){j(this.pseudoItems[D].el).onTapEnd(function(H){var G=j(H.el),E=H.el.getAttribute("moo-foreach-index"),F=function(){if(G.hasClass("moo-active")){C.unselect(E)}else{C.select(E)}};if(j.context.userAgent==="android"){window.setTimeout(function(){F()},0)}else{F()}b(H)})}},select:function(C){if(this.value.indexOf(C)<0){this.value.push(C.toString());this.items[C].el.setAttribute("checked","checked");j(this.pseudoItems[C].el).setClass("moo-active")}},unselect:function(C){this.value.splice(this.value.indexOf(C),1);this.items[C].el.removeAttribute("checked","");j(this.pseudoItems[C].el).removeClass("moo-active")},unselectAll:function(){var C=0;for(C=this.items.length;C--;){this.unselect(C)}},selectByValue:function(E){var D,C;if(Object.prototype.toString.call(E)!=="[object Array]"){E=[E]}for(D=this.items.length;D--;){for(C=E.length;C--;){if(this.items[D].value===E[C]){j(this.pseudoItems[D].el).setClass("moo-active");this.select(D)}}}}};var u=function(C){var D=0,E=this.pseudoItems=[];this.input=C.el;j(this.input).hide();this._makeHTML();E=j(this.container).find("div");for(D=0;D<E.length;D++){this.pseudoItems.push({el:E[D],value:E[D].value,mooSelectIndex:D})}this._setTouchEvents();if(C.value!==undefined){this.selectByValue(C.value)}return this};u.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=B({template:A.radio,self:this});this.container=j(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var C=this,D=0;for(D=0;D<this.pseudoItems.length;D++){j(this.pseudoItems[D].el).onTapEnd(function(E){b(E);C.select(E.el.getAttribute("moo-foreach-index"))})}},select:function(D){var C=this,E;for(E=0;E<C.pseudoItems.length;E++){j(C.pseudoItems[E].el).removeClass("moo-active");C.pseudoItems[E].el.removeAttribute("checked","checked")}j(C.pseudoItems[D].el).setClass("moo-active");this.value=this.items[D].value;this.selectedIndex=D;this.input.selectedIndex=D;this.items[this.selectedIndex].el.setAttribute("checked","checked")},selectByValue:function(D){var C;for(C=this.items.length;C--;){if(this.items[C].value===D){this.select(C)}}}};var q=function(C){var D=0,E=this.pseudoItems=[];this.y=0;this.input=C.el;this._visibility="hidden";this._makeHTML();this._setTouchEvents();E=j(this.input).find("option");for(D=0;D<E.length;D++){this.pseudoItems.push({el:E[D],mooSelectIndex:D})}if(C.value!==undefined){this.selectByValue(C.value)}this.select(0);return this};q.prototype={_makeHTML:function(){var E=document.createElement("div"),D=A.select,C=this.input.parentElement;E.innerHTML=B({template:D,self:this});this.el=E.firstChild;this.el.parentElement.insertBefore(this.input);C.appendChild(E);this.box=j(this.el).find(".moo-ui-select-menu")[0];this.textspan=j(this.el).find(".moo-ui-select-text")[0]},_setTouchEvents:function(){var C=this;j(this.input).onTapEnd(function(D){if(C._visibility!=="visible"){C.input.focus();C._visibility="visible"}});j(this.input).on("blur",function(){C._visibility="hidden"});j(this.input).on("change",function(){C.select(C.input.selectedIndex)});j(this.el).onDragStart(b)},select:function(D){var C=this;window.setTimeout(function(){j(C.box).hide();C._visibility="hidden"},100);this.value=this.pseudoItems[D].el.value;this.selectedIndex=D;this.input.selectedIndex=D;j(this.textspan).html(this.pseudoItems[D].el.innerText)},selectByValue:function(D){var C;for(C=this.pseudoItems.length;C--;){if(this.pseudoItems[C].el.value===D){this.select(C)}}}};var z=false,w=function(D){var C=this;this.el=this.input=D.el;if(D.value!==undefined){this.el.value=D.value}this.value=C.el.value;this._makeHTML();j(this.el).onDragStart(b);j(this.el).onTapEnd(function(E){E.el.focus();b(E)});j(this.cleanbox).onTapEnd(function(){C.clean()});this.el.onblur=function(){window.scrollTo(0,0)};return this};w.focused=false;w.prototype={_makeHTML:function(){var E,D=this.el.parentElement,C=this;this.cleanbox=document.createElement("div");this.cleanbox.innerHTML=A.text;E=document.createElement("div");j(E).setClass("moo-ui-text");E.appendChild(this.cleanbox);E.appendChild(this.input);j(this.input).on("keyup",function(F){C.value=C.input.value;if(typeof C.onChange==="function"){C.onChange()}});D.appendChild(E)},clean:function(){this.input.value="";this.input.focus()},on:function(C,D){if(C==="change"){this.onChange=D}}};var x=function(D){var C=this;this.el=this.input=D.el;if(D.value!==undefined){this.el.innerHTML=D.value}this.value=C.el.innerHTML;this._makeHTML();j(this.el).onDragStart(b);j(this.el).onTapEnd(function(E){E.el.focus();b(E)});return this};x.prototype={_makeHTML:function(){var E,D=this.el.parentElement,C=this;j(this.input).on("keyup",function(F){C.value=C.input.value});E=document.createElement("div");j(E).setClass("moo-ui-textarea");E.appendChild(this.input);D.appendChild(E)}};var l=function(C){this.input=C.el;this.position=C.position;this.count=0;l._makeHTML(C,this);l._setTouchEvents(this);l._initProperties(this,C);if(C.value!==undefined){this.value=C.value}else{this.value=[]}return this};l.prototype={show:function(){if(typeof this.onShowBox==="function"){this.onShowBox()}j(this.el).show();this._visibility="visible"},hide:function(){j(this.el).hide();this._visibility="hidden"},onShowBox:function(C){this.onShowBox=C},onCamera:function(C){this.onCamera=C},onSuccess:function(C){this.onSuccess=C},onFail:function(C){this.onFail=C},onChange:function(C){this.onChange=C},push:function(G){var C=document.createElement("div"),F,E=this,D;C.innerHTML=this.imageWrapper.outerHTML;D=j(C).find(".moo-image");F=D[0];F.setAttribute("moo-index",this.count);D=j(E.imageList).find("li");for(i=D.length;i--;){j(D[i].firstChild).removeClass("moo-active")}j(F).setClass("moo-active");E.itemSelected=this.count;j(F).onTapEnd(function(K){var J=j(K.el),I,H=j(E.imageList).find("li");if(J.hasClass("moo-active")===false){for(I=H.length;I--;){j(H[I].firstChild).removeClass("moo-active")}j(K.el).setClass("moo-active");E.itemSelected=K.el.getAttribute("moo-index")}});F.appendChild(G);this.value.push(G.getAttribute("src"));j(C.firstChild).show();this.imageList.appendChild(C.firstChild);j(this.el).removeClass("moo-empty");this.count++},clear:function(){var C=j(this.imageList).find("li"),D=0;for(D=C.length;D--;){this.imageList.removeChild(C[D])}this.count=0;this.value=[]},removeItem:function(D){var C=j(this.imageList).find("li"),E=0;console.log("remove item!");this.imageList.removeChild(C[E]);this.value.splice(D,1);this.count=C.length-1;if(typeof this.onChange==="function"){this.onChange(this,D)}j(C[this.count]).setClass("moo-active");this.itemSelected=this.count}};j.extend({_makeHTML:function(E,D){var F=document.createElement("div"),C;F.innerHTML=A.camera;D.el=F.firstChild;C=j(D.el);C.setClass("moo-empty");if(D.position==="top"){C.setClass("moo-top")}else{if(D.position==="bottom"){C.setClass("moo-bottom")}}D.takeButton=C.find(".moo-ui-add-new")[0];D.chooseButton=C.find(".moo-ui-add-filed")[0];if(E.labelTakeButton!==undefined){D.takeButton.innerHTML=E.labelTakeButton}if(E.labelChooseButton!==undefined){D.chooseButton.innerHTML=E.labelChooseButton}D.imageWrapper=C.find(".moo-image-wrapper")[0];D.imageList=C.find(".moo-image-list")[0];C.hide();D._visibility="hidden";D.input.appendChild(D.el);j(D.imageWrapper).hide()},_setTouchEvents:function(C){j(C.input).onTapEnd(function(){if(C._visibility==="hidden"){C.show()}else{C.hide()}});j(C.el).onTapEnd(function(){C.hide()});j(C.takeButton).onTapEnd(function(){l.camera(C)});j(C.chooseButton).onTapEnd(function(){l.camera(C,"album")})},_initProperties:function(C,D){C.quality=C.quality?C.quality:50;C.width=C.width?C.width:1024;C.height=C.height?C.height:768},camera:function(C,D){var E,F;if(typeof C.onCamera==="function"){C.onCamera()}if(C.disabled!==true){if(window.Camera!==undefined){if(D==="album"){E=window.Camera.PictureSourceType.SAVEDPHOTOALBUM}F=function(G){C.onSuccess(G)};navigator.camera.getPicture(F,C.onFail,{quality:C.quality,destinationType:window.Camera.DestinationType.FILE_URI,sourceType:E,targetWidth:C.width,targetHeight:C.height})}else{console.log("Not camera! using sample pic");C.onSuccess("img/temp/samplepic.jpg")}}}},l);var e=function(C){this.input=C.el;this.sourceType=C.sourceType;e._setTouchEvents(this);e._initProperties(this,C);if(C.value!==undefined){this.value=C.value}else{this.value=[]}return this};e.prototype={onCamera:function(C){this.onCamera=C},onSuccess:function(C){this.onSuccess=C},onFail:function(C){this.onFail=C},onChange:function(C){this.onChange=C},};j.extend({_setTouchEvents:function(C){if(C.sourceType==="album"){j(C.input).onTapEnd(function(){l.camera(C,"album")})}else{j(C.input).onTapEnd(function(){l.camera(C)})}},_initProperties:function(C,D){C.quality=C.quality?C.quality:50;C.width=C.width?C.width:1024;C.height=C.height?C.height:768},camera:function(C,D){var E,F;if(typeof C.onCamera==="function"){C.onCamera()}if(C.disabled!==true){if(window.Camera!==undefined){if(D==="album"){E=window.Camera.PictureSourceType.SAVEDPHOTOALBUM}F=function(G){C.onSuccess(G)};navigator.camera.getPicture(F,C.onFail,{quality:C.quality,destinationType:window.Camera.DestinationType.FILE_URI,sourceType:E,targetWidth:C.width,targetHeight:C.height})}else{console.log("Not camera! using sample pic");C.onSuccess("img/temp/samplepic.jpg")}}}},e);var h=function(D){var C=this;this.el=D.el;h._setTouchEvents(C);if(D.key!==undefined){C.key=D.key}else{C.key=""}C.onLoad=D.onLoad;h._includeScript(C.key,function(){h._API=google.maps;h._initProperties(C,D);h._initMap(C,D);if(typeof C.onLoad==="function"){C.onLoad()}return C})};h.prototype={addMarker:function(D){var C=new k(D,this.map);C.setMap(this);return this}};var k=function(D,F){var E,C=this;this.lat=D.lat;this.lon=D.lon;this.html=D.html;this._APIMarker=new h._API.Marker();this._APIMarker.setPosition(new h._API.LatLng(this.lat,this.lon));E=new h._API.InfoWindow({content:C.html});h._API.event.addListener(this._APIMarker,"click",function(){E.open(F,C._APIMarker)});return this};k.prototype={setMap:function(C){this._APIMarker.setMap(C.map)}};j.extend({_setTouchEvents:function(C){j(C.el).on("touchmove",function(D){D.stopPropagation()})},_initProperties:function(C,D){C.width=D.width?D.width:"100%";C.height=D.height?D.height:"100%";C.el.setAttribute("style","width:"+C.width+";height:"+C.height);C.zoom=D.zoom?D.zoom:13;C.center=D.center?D.center:[-34.599567,-58.372553];C.mapType=D.mapType?D.mapType:h._API.MapTypeId.ROADMAP},_includeScript:function(C,D){j._UIMapCallbacks=D;a(h._APIScript+"&key="+C)},_initMap:function(C){var D;D={zoom:C.zoom,center:new h._API.LatLng(C.center[0],C.center[1]),mapTypeId:C.mapType};C.map=new h._API.Map(C.el,D)},_APIScript:"https://maps.googleapis.com/maps/api/js?sensor=false&callback=$._UIMapCallbacks"},h);var a=function(C,E){var D=document.createElement("script");D.type="text/javascript";D.setAttribute("src",C);D.onload=E;document.body.appendChild(D)};var n=function(){};j.extend({ui:function(C){var D=n.get(this.query);if(D===undefined){C.el=this.el;switch(C.type){case"ToggleSwitch":D=new t(C);break;case"Text":D=new w(C);break;case"TextArea":D=new x(C);break;case"Select":D=new q(C);break;case"Radio":D=new u(C);break;case"Checkbox":D=new s(C);break;case"Camera":D=new l(C);break;case"SimpleCamera":D=new e(C);break;case"Map":D=new h(C);break}D.id=this.query;D.type=C.type;n.push(D);return D}else{return n.get(this.query)}}});var y={};j.extend({ui:{overlay:function(){return new o()},loading:function(){return new m()},modal:function(C){return new c()}}},j);j(document).ready(function(){var C=new o(),D=new m();j.extend({loadingScreen:{show:function(){C.show();D.show()},hide:function(){C.hide();D.hide()}}},j)});j.extend({_collection:[],get:function(D){var C;for(C=n._collection.length;C--;){if(n._collection[C].id===D){return n._collection[C]}}},push:function(C){this._collection.push(C)}},n);var b=function(C){C.e.stopPropagation();C.e.preventDefault()}}(Mootor));