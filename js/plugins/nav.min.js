(function(e){var a=function(k){a.init(k,this);this.header=new h(this);this.footer=new i(this);return this},c;a.prototype={el:undefined,set:function(l){var k=this.get(l);if(this._config.isMoving===false){this._config.isMoving=true;if(this.current!==k.index){this._config.back=this.current;if(this._config.direction===0){this.history.push(this.current)}this.current=k.index;a.load(this)}}return k},get:function(l){var k;for(k=this._config.count;k--;){if(this.items[k].el.id===l){return this.items[k]}}return null},goBack:function(){if(this.history.length>0){if(this._config.isMoving===false){this._config.direction=-1;this._config.back=this.history.pop();this.set(this.items[this._config.back].el.id)}}return this.items[this.current].index},handleGesture:function(k){a.handleGesture(k,this)}};c=function(k){this.el=k.el;this.id=this.el.id;this.index=k.index;this.height=k.height;this.x=k.x;this.y=k.y;return this};e.extend({getLinks:function(l,m){var k,o,n=[];k=e(l.el).find("."+m._config.navClass);for(o=0;o<k.length;o++){if(k[o].getAttribute("href").replace("#","")!==""){n.push(k[o])}}return n},loadNavigationItem:function(o,l,m){var n=0,k="";for(n=l.navigationItemsCount;n--;){e(l.navigationItems[n]).removeClass("active")}m._config.direction=0;if(m._config.isMoving===false){k=o.el.getAttribute("href");if(k&&k!==""){o.e.stopPropagation();m.set(k.replace("#",""))}}},initNavigationItems:function(k,l){var n,m;k.navigationItems=c.getLinks(k,l);k.navigationItemsCount=k.navigationItems.length;for(m=k.navigationItemsCount;m--;){n=k.navigationItems[m];if(e(n).hasClass(l._config.navClass)===false){e(n).onTapEnd(function(o){window.location=o.el.href})}else{if(n.getAttribute("href").replace("#","")!==""){e(n).onTapStart(function(o){e(o.el).setClass("active")});e(n).onTapEnd(function(o){c.loadNavigationItem(o,k,l)})}}}k.initNavigation=function(){c.initNavigationItems(k,l)};return k}},c);e.extend({nav:function(k){var l;if(typeof k!=="object"){k={}}k.el=this.el;k._query=this.query;l=a.get(this.query);if(l===undefined){return new a(k)}else{return l}}});e.extend({_collection:[],init:function(l,k){k.el=l.el;k._options=l;a.initProperties(k,l);e(k.el).setClass(k._config.containerClassName);a.initItems(k);e(k.el).onDragMove(k);e(k.el).onDragEnd(k);a.initResizeEvents(k);return k},initProperties:function(k,l){var m;k._config={x:0,y:0,back:0,isMoving:false,direction:0,width:e.view.clientW,height:e.view.clientH,transitions:l.transitions,headerClassName:l.headerClassName?l.headerClassName:"moo-header",footerClassName:l.footerClassName?l.footerClassName:"moo-footer",navClass:l.navLinksClassName?l.navLinksClassName:"moo-nav",hiddenClassName:l.hiddenClassName?l.hiddenClassName:"moo-hidden",margin:l.margin?l.margin:5,containerClassName:l.containerClassName?l.containerClassName:"moo-panels",itemClass:l.itemsClassName?l.itemsClassName:"moo-panel",type:l.type?l.type:"Panels"};if(k._config.transitions===undefined){k._config.transitionDuration=0.25}else{k._config.transitionDuration=0}if(k._config.type==="Panels"){m=j}k._config.navItem=m;k.items=[];k.current=0;k.history=[];a._collection.push(k);k.id=l.id?l.id:l._query},handleGesture:function(l,k){l.e.preventDefault();switch(l.type){case"dragMove":a.move(l,k);break;case"dragEnd":k._config.navItem.checkMove(l,k);break}},nav:function(l,k){l._anchors=k.el.getElementsByClassName(k._options.navClass)},move:function(l,k){var m=k.items[k.current];if(l.isDraggingY!==0&&m.movable!==false){k._config.navItem.move(k,m,l)}},load:function(k){k._config.navItem.load(k)},initResizeEvents:function(k){e(window).bind("resize",function(){setTimeout(function(){if(k.header!==undefined){k._config.height=e.view.clientH-k.header.height}else{k._config.height=e.view.clientH}},1)})},initItems:function(k){var l,m,n=k.el.getElementsByClassName(k._config.itemClass);k.items=[];for(l=0;l<n.length;l++){m=new c({el:n[l],index:l,x:0,y:0});c.initNavigationItems(m,k);k.items.push(m)}k._config.count=l;a.initNavItemStyles(k)},initNavItemStyles:function(k){k._config.navItem.initStyles(k)},preventNativeScrolling:function(){e(document).ready(function(){e(document.body).bind("touchmove",function(k){k.preventDefault();k.stopPropagation()})})},get:function(k){return a._collection.map(function(l){if(l.id===k){return l}})[0]},_scrollBar:function(k){}},a);a.preventNativeScrolling();var h=function(k){this.el=e("header")[0];if(this.el!==undefined){this.height=this.el.offsetHeight;this.el.style.height=this.height+"px";d(this.height,k);e(this.el).setClass(k._config.headerClassName);h.initAnchorBack(this,k);h.initNavigationLinks(this,k);h.preventNativeScrolling(this);return this}else{return undefined}};h.prototype={setTitle:function(k){e(this.el).find("h1")[0].innerText=k}};e.extend({initAnchorBack:function(k,l){var m=l._config.anchorBack=e(e(k.el).find(".moo-nav-back")[0]);if(m.el!==undefined){m.hide();m.el.onclick=function(){return false};m.onTapEnd(function(n){l.goBack()})}},preventNativeScrolling:function(k){e(k.el).on("touchmove",function(l){l.preventDefault()})},initNavigationLinks:function(k,l){var n=e(k.el).find(".moo-nav"),m;for(m=n.length;m--;){e(n[m]).onTapEnd(function(o){c.loadNavigationItem(o,k,l)})}}},h);var d=function(k,l){var m;for(m=l._config.count;m--;){l.items[m].el.style.paddingTop=k+"px"}};var i=function(k){this.el=e("footer")[0];if(this.el!==undefined){this.height=this.el.offsetHeight;this.el.style.height=this.height+"px";g(this,k);e(this.el).setClass(k._config.footerClassName);i.initNavigationLinks(this,k);i.preventNativeScrolling(this);return this}else{return undefined}};e.extend({preventNativeScrolling:function(k){e(k.el).on("touchmove",function(l){l.preventDefault()})},initNavigationLinks:function(k,l){var n=e(k.el).find(".moo-nav"),m;for(m=n.length;m--;){e(n[m]).onTapEnd(function(o){c.loadNavigationItem(o,k,l)})}}},i);var g=function(m,k){var l;for(l=k._config.count;l--;){k.items[l].el.style.paddingBottom=m.height+"px"}};var j=function(){},b=function(k){k.duration=k.duration?k.duration:0;k.callback=k.callback?k.callback:function(){};k.y=k.y?k.y:0;k.x=k.x?k.x:0;e(k.el).translateFx({y:k.y,x:k.x},{transitionDuration:k.duration,callback:k.callback})};var f=function(m,k,l){var n=m._config;e(l.el).hide();n.isMoving=false;k.x=0;n.x=0;b({el:m.el,x:0},m);b({el:k.el,x:0},m)};e.extend({load:function(q){var k,r,o,p,s,n,l=q._config,m;k=q.items[q.current];o=q.items[l.back];e(k.el).show();p=l.width+l.margin;if(q.current!==0){l.anchorBack.show()}else{l.anchorBack.hide()}if(l.direction===0||l.back===0){b({el:k.el,x:p},q);k.x=p;p=-p}else{b({el:k.el,x:-p},q);k.x=-p;p=p}window.setTimeout(function(){b({el:q.el,duration:l.transitionDuration,x:p,callback:function(){f(q,k,o)}},q)},1);if(typeof k.onLoad==="function"){k.onLoad()}},initStyles:function(k){var l=0,m={};for(l=k._config.count;l--;){m=k.items[l];if(l>0){b({el:m.el,x:-((k._config.width+k._config.margin)*4),y:0},k);e(m.el).hide()}else{b({el:m.el,x:0},k)}m.height=m.el.offsetHeight;if(k._config.height>m.height){m.height=k._config.height}}},checkMove:function(n,l){var k=l.items[l.current],o=k.height-l._config.height,m;if(l.header!==undefined){o+=l.header.height}if(n.type==="dragEnd"){if(l._config.y>=0||o<-l._config.y){if(l._config.y>0){l._config.y=0}else{l._config.y=-o}for(m=k.navigationItems.length;m--;){e(k.navigationItems[m]).removeClass("active")}b({y:l._config.y,el:k.el,duration:0.25},l)}}},move:function(m,p,o){var k=false;m._config.y=m._config.y+(o.y-o.lastY);var l=m.items[m.current],q=l.height-m._config.height,n;if(m.header!==undefined){q+=m.header.height}if(m._config.transitions===false){if(m._config.y<0&&q>-m._config.y){k=true}}else{k=true}if(k===true){b({el:p.el,y:m._config.y,x:p.x},m)}},setStylesWhenHeaderOrFooterIsActive:function(k,l){var m;for(m=l._config.count;m--;){l.items[m].el.style.paddingTop=k+"px"}}},j)}(Mootor));