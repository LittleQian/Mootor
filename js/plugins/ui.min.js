(function(f){var s={radio:'<div moo-template="foreach: input"><div class="moo-ui-radio"><label><span class="moo-ui-radio-label" moo-template="text: this.label"></span><span class="moo-ui-radio-icon"> &nbsp;</span></label></div></div>',checkbox:'<div moo-template="foreach: input"><div class="moo-ui-checkbox"><label><span class="moo-ui-checkbox-label" moo-template="text: this.label"></span><span class="moo-ui-checkbox-icon"> &nbsp;</span></label></div></div>',overlay:"<div class='moo-overlay'></div>",loading:"<div class='moo-ui-loading'><div class='moo-ui-loading-block moo-loading-01'></div><div class='moo-ui-loading-block moo-loading-02'></div><div class='moo-ui-loading-block moo-loading-03'></div><div class='moo-ui-loading-block moo-loading-04'></div><div class='moo-ui-loading-block moo-loading-05'></div><div class='moo-ui-loading-block moo-loading-06'></div><div class='moo-ui-loading-block moo-loading-07'></div><div class='moo-ui-loading-block moo-loading-08'></div></div>",modal:"<div class='moo-ui-modal-container'><div class='moo-ui-modal-panel' moo-template='html: this.html'></div></div>",_switch:"<div class='moo-ui-switch'><b><span class='moo-before'>I</span><span class='moo-button'>&nbsp;</span><span class='moo-after'>O</span></b></div>",text:'<span class="cleanbox">&times</span>',select:'<div class="moo-ui-select-container"><span class="moo-ui-select-text"></span><span class="mo-ui-select-link"> &#9660;</span><div class="moo-ui-select-menu" style="height:217px;display:none"><div class="moo-ui-select-wrapper"><ul class="moo-ui-select-list" moo-template="foreach: option"><li moo-template="text: this.text"></li></ul></div></div>'},l=function(u){return u.split(" ").join("")},t=function(C){var A=C.template,B=C.self,u=[],x=document.createElement("div"),z=[],v=0,y=[],w;x.innerHTML=A;z=x.getElementsByTagName("*");for(v=z.length;v--;){if(z[v].getAttribute("moo-template")!==null){y=l(z[v].getAttribute("moo-template")).split(":");u.push({el:z[v],key:y[0],value:y[1]})}if((w=z[v].getAttribute("moo-foreach-index"))!==null){u[v].index=w}}if(c(u)===true){for(v=u.length;v--;){if(u[v].key==="foreach"){j(u[v],B)}}}else{for(v=u.length;v--;){switch(u[v].key){case"text":d(u[v],B);break;case"html":e(u[v],B);break}}}return x.innerHTML},c=function(v){var u;for(u=v.length;u--;){if(v[u].key==="foreach"){return true}}return false},j=function(u,C){var E=u.value,y=C.input.getElementsByTagName(E),v=0,D={},w=u.el.innerHTML,z=[],B,x=[],A=document.createElement("div");C.items=[];z=f(C.input).find(E);if(E==="input"){x=f(C.input).find("label")}for(v=0;v<z.length;v++){C.items.push({el:z[v],text:z[v].innerText});B=C.items[C.items.length-1];if(E==="input"){B.label=x[v]}if(B.el.value!==undefined){B.value=B.el.value}}u.el.innerHTML="";for(v=0;v<y.length;v++){D=document.createElement("div");D.innerHTML=w;D.firstChild.setAttribute("moo-foreach-index",v);D.firstChild.setAttribute("moo-foreach-value",C.items[v].value);D.innerHTML=t({template:D.innerHTML,self:C});A.appendChild(D.firstChild)}u.el.innerHTML=A.innerHTML},d=function(w,u){var v=w.index,y="",x="";if(w.value.indexOf("this.")>-1){y=w.value.replace("this.","");x=u.items[v][y];if(typeof x==="string"){w.el.innerText=x}else{w.el.innerText=x.innerText}}},e=function(w,u){var v=w.index,x="";if(w.value.indexOf("this.")>-1){x=w.value.replace("this.","");w.el.innerHTML=u[x]}};var i=function(){if(i.el===undefined){i._makeHTML({type:"overlay",object:i})}this.el=i.el;return this},b=function(){if(b.el===undefined){i._makeHTML({type:"modal",object:b})}this.el=b.el;return this},g=function(){if(g.el===undefined){i._makeHTML({type:"loading",object:g})}this.el=g.el;return this};g.prototype=i.prototype={show:function(){f(this.el).removeClass("moo-hidden")},hide:function(){f(this.el).setClass("moo-hidden")},};b.prototype={html:function(u){this.html=u;this.el.innerHTML=t({template:this.el.innerHTML,self:this})}};f.extend(i.prototype,b.prototype);f.extend({el:undefined,_makeHTML:function(v){var x=v.type,u=v.object,w=document.createElement("div");w.innerHTML=s[x];u.el=w.firstChild;f(u.el).setClass("moo-hidden");f(document.body).el.appendChild(u.el)}},i);var o=function(){};var q=function(v){var u=this;this.input=v.el;f(this.input).hide();this._makeHTML();this._setTouchEvents();if(v.value){this.input.value=v.value}this.toggle(this.input.value);return this};q.prototype={_makeHTML:function(){var u;u=document.createElement("div");u.innerHTML=s._switch;this.el=u.firstChild;this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var w=this,x=f(w.el).find("b")[0],u=w.el.offsetWidth-32,y=u/3,v=0;w.x=0;w.isDragging=0;f(this.el).onTapEnd(function(z){w.toggle()});f(this.el).onSwipeRight(function(z){w._swipe=1});f(this.el).onSwipeLeft(function(z){w._swipe=-1});f(this.el).onDragMove(function(z){var A=w.x+(z.x-z.lastX);w.isDragging=1;f(w.el).removeClass("moo-on");f(w.el).removeClass("moo-off");z.e.stopPropagation();if((A<=u)&&(A>-4)){w.x=A;f(x).translateFx({x:w.x,y:0},{transitionDuration:0})}});f(this.el).onDragEnd(function(z){var A;z.e.stopPropagation();f(x).cleanFx();if(w._swipe!==0&&z.time<400){if(w._swipe===1){w.toggle(1)}else{w.toggle(0)}}else{if(w.isDragging===1){w.isDragging=0;if(w.x<(u/2)){w.toggle(0)}else{w.toggle(1)}}}})},toggle:function(v){var u=f(this.el);if(v!==undefined){this.value=+v}else{if(this.value===0){this.value=1}else{this.value=0}}if(this.value===0){u.removeClass("moo-on");u.setClass("moo-off")}else{u.removeClass("moo-off");u.setClass("moo-on")}this.input.value=this.value;if(typeof this.onChange==="function"){this.onChange()}},on:function(u,v){switch(u){case"change":this.onChange=v;break}}};var m=function(v){var u=this,w=0,x;this.input=v.el;f(this.input).hide();this._makeHTML();this.mooItems=f(this.el).find(".moo-ui-checkbox");for(w=this.mooItems.length;w--;){x=this.mooItems[w];f(x).onTapEnd(function(y){u.set(f(y.e.target))})}};m.prototype={_makeHTML:function(){var v=s.checkbox,u;this.el=document.createElement("div");this.el.innerHTML=t({template:v,self:this});this.input.parentElement.appendChild(this.el)},set:function(x){var w=0,v=0,u={},A,y,z=true;if(f(x.el).hasClass("moo-ui-checkbox-icon")===false){A=f(x.el.parentElement).find(".moo-ui-checkbox-icon")[0]}else{A=x.el}for(w=this.mooItems.length;w--;){u=f(this.mooItems[w]).find(".moo-ui-checkbox-icon");for(v=u.length;v--;){if(u[v]===A){if(f(u[v]).hasClass("moo-active")===false){f(u[v]).setClass("moo-active");z=true}else{f(u[v]).removeClass("moo-active");z=false}y=w}}}if(z===true){this.items[y].el.setAttribute("checked","checked")}else{this.items[y].el.removeAttribute("checked","checked")}}};var n=function(v){var u=this,w=0;this.input=v.el;f(this.input).hide();this._makeHTML();this.mooItems=f(this.el).find(".moo-ui-radio");for(w=this.mooItems.length;w--;){f(this.mooItems[w]).onTapEnd(function(x){u.activate(f(x.e.target))})}};n.prototype={_makeHTML:function(){var v=s.radio,u;this.el=document.createElement("div");this.el.innerHTML=t({template:v,self:this});this.input.parentElement.appendChild(this.el)},activate:function(x){var w=0,v=0,u={},y;if(f(x.el).hasClass("moo-ui-radio-icon")===false){y=f(x.el.parentElement).find(".moo-ui-radio-icon")[0]}else{y=x.el}for(w=this.mooItems.length;w--;){u=f(this.mooItems[w]).find(".moo-ui-radio-icon");for(v=u.length;v--;){if(u[v]!==y){f(u[v]).removeClass("moo-active");this.items[w].el.removeAttribute("checked")}else{f(u[v]).setClass("moo-active");this.selectedIndex=w}}}this.items[this.selectedIndex].el.setAttribute("checked","checked")}};var k=function(v){var u=this,w=0,x=this.pseudoItems=[];this.y=0;this.input=v.el;this.position=v.position;f(this.input).hide();this._makeHTML();this._setTouchEvents();x=f(this.ul).find("li");for(w=0;w<x.length;w++){this.pseudoItems.push({el:x[w],mooSelectIndex:w})}if(v.value!==undefined){this.selectByValue(v.value)}return this};k.prototype={_makeHTML:function(){var v=document.createElement("div"),u=s.select;v.innerHTML=t({template:u,self:this});this.el=v.firstChild;if(this.position=="top"){f(this.el).setClass("moo-top")}else{if(this.position=="bottom"){f(this.el).setClass("moo-bottom")}}this.input.parentElement.appendChild(this.el);this.ul=f(this.el).find("ul")[0];this.box=f(this.el).find(".moo-ui-select-menu")[0];this.textspan=f(this.el).find(".moo-ui-select-text")[0]},_setTouchEvents:function(){var u=this;f(this.el).onTapEnd(function(v){f(u.box).show()});f(this.el).onDragStart(a);f(this.ul).onTapEnd(function(w){var v;a(w);for(v=0;v<u.pseudoItems.length;v++){f(u.pseudoItems[v].el).removeClass("selected")}f(w.e.target).setClass("selected");u.select(w.e.target.getAttribute("moo-foreach-index"))});f(this.ul).onDragMove(function(w){var x,v;a(w);x=u.y+(w.y-w.lastY);if((x<=0)&&(x>=-(u.ul.offsetHeight-160))){u.y=x;f(u.ul).translateFx({x:0,y:u.y},{})}})},select:function(v){var u=this;window.setTimeout(function(){f(u.box).hide()},100);this.value=this.items[v].value;this.selectedIndex=v;this.input.selectedIndex=v;f(this.textspan).html(this.pseudoItems[v].el.innerHTML)},selectByValue:function(v){var u;for(u=this.items.length;u--;){if(this.items[u].value===v){this.select(u)}}}};var p=function(v){var u=this;this.el=this.input=v.el;if(v.value!==undefined){this.el.value=v.value}this.value=u.el.value;this._makeHTML();f(this.el).onDragStart(a);f(this.el).onTapEnd(function(w){w.el.focus();w.el.onblur=function(){window.scrollTo(0,0)};a(w)});f(this.cleanbox).onTapEnd(function(){u.clean()});return this};p.prototype={_makeHTML:function(){var w,v=this.el.parentElement,u=this;this.cleanbox=document.createElement("div");this.cleanbox.innerHTML=s.text;w=document.createElement("div");f(w).setClass("moo-ui-text");w.appendChild(this.cleanbox);w.appendChild(this.input);f(this.input).on("keyup",function(x){u.value=u.input.value;if(typeof u.onChange==="function"){u.onChange()}});v.appendChild(w)},clean:function(){this.input.value="";this.input.focus()},on:function(u,v){switch(u){case"change":this.onChange=v;break}}};var r=function(v){var u=this;this.el=this.input=v.el;this._makeHTML();f(this.el).onDragStart(a);f(this.el).onTapEnd(function(w){w.el.focus();a(w)});return this};r.prototype={_makeHTML:function(){var v,u=this.el.parentElement;v=document.createElement("div");f(v).setClass("moo-ui-textarea");v.appendChild(this.input);u.appendChild(v)},};var h=function(){};f.extend({ui:function(u){var v=h.get(this.query);if(v===undefined){u.el=this.el;switch(u.type){case"Switch":v=new q(u);break;case"Text":v=new p(u);break;case"TextArea":v=new r(u);break;case"Select":v=new k(u);break;case"Radio":v=new n(u);break;case"Checkbox":v=new m(u);break}v.id=this.query;h.push(v);return v}else{return h.get(this.query)}},});f.extend({ui:{overlay:function(){return new i()},loading:function(){return new g()},modal:function(u){return new b()}}},f);f.extend({_collection:[],get:function(v){var u;for(u=h._collection.length;u--;){if(h._collection[u].id===v){return h._collection[u]}}},push:function(u){this._collection.push(u)}},h);var a=function(u){u.e.stopPropagation();u.e.preventDefault()}}(Mootor));