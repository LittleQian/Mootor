(function(g){var x={radio:'<div moo-template="foreach: input"><div class="moo-ui-radio"><label><span class="moo-ui-radio-label" moo-template="text: this.label"></span><span class="moo-ui-radio-icon"> &nbsp;</span></label></div></div>',checkbox:'<div moo-template="foreach: input"><div class="moo-ui-checkbox"><label><span class="moo-ui-checkbox-label" moo-template="html: this.label"></span><span class="moo-ui-checkbox-icon"> &nbsp;</span></label></div></div>',overlay:"<div class='moo-overlay'></div>",loading:"<div class='moo-ui-loading'><div class='moo-ui-loading-block moo-loading-01'></div><div class='moo-ui-loading-block moo-loading-02'></div><div class='moo-ui-loading-block moo-loading-03'></div><div class='moo-ui-loading-block moo-loading-04'></div><div class='moo-ui-loading-block moo-loading-05'></div><div class='moo-ui-loading-block moo-loading-06'></div><div class='moo-ui-loading-block moo-loading-07'></div><div class='moo-ui-loading-block moo-loading-08'></div></div>",modal:"<div class='moo-ui-modal-container'><div class='moo-ui-modal-panel' moo-template='html: this.html'></div></div>",toggleswitch:"<div class='moo-ui-switch'><b><span class='moo-before'>I</span><span class='moo-button'>&nbsp;</span><span class='moo-after'>O</span></b></div>",text:'<span class="cleanbox">&times</span>',select:'<div class="moo-ui-select-container"><span class="moo-ui-select-text"></span><span class="moo-ui-select-link"> &#9660;</span><div class="moo-ui-select-menu" style="height:217px;display:none"><div class="moo-ui-select-wrapper"></div></div></div>',camera:"<div class='moo-ui-image-container'><div class='moo-ui-image-panel'><ul class='moo-image-list'><li class='moo-image-wrapper'><div class='moo-image'></div></li></ul></div><header><a class='moo-ui-add-new' href='#takepic'>Take a picture</a><a class='moo-ui-add-filed' href='#choosepic'>Choose a picture</a><a class='moo-ui-delete' href='#delete'></a><a class='moo-ui-add-comment' href='#addcomment'></a></header></div>"},o=function(z){return z.split(" ").join("")},y=function(H){var F=H.template,G=H.self,z=[],C=document.createElement("div"),E=[],A=0,D=[],B;C.innerHTML=F;E=C.getElementsByTagName("*");for(A=E.length;A--;){if(E[A].getAttribute("moo-template")!==null){D=o(E[A].getAttribute("moo-template")).split(":");z.push({el:E[A],key:D[0],value:D[1]})}if((B=E[A].getAttribute("moo-foreach-index"))!==null){z[A].index=B}}if(c(z)===true){for(A=z.length;A--;){if(z[A].key==="foreach"){m(z[A],G)}}}else{for(A=z.length;A--;){switch(z[A].key){case"text":e(z[A],G);break;case"html":f(z[A],G);break}}}return C.innerHTML},c=function(A){var z;for(z=A.length;z--;){if(A[z].key==="foreach"){return true}}return false},m=function(z,H){var J=z.value,D=H.input.getElementsByTagName(J),A=0,I={},B=z.el.innerHTML,E=[],G,C=[],F=document.createElement("div");H.items=[];E=g(H.input).find(J);if(J==="input"){C=g(H.input).find("label")}for(A=0;A<E.length;A++){H.items.push({el:E[A],text:E[A].innerText});G=H.items[H.items.length-1];if(J==="input"){G.label=C[A]}if(G.el.value!==undefined){G.value=G.el.value}}z.el.innerHTML="";for(A=0;A<D.length;A++){I=document.createElement("div");I.innerHTML=B;I.firstChild.setAttribute("moo-foreach-index",A);I.firstChild.setAttribute("moo-foreach-value",H.items[A].value);I.innerHTML=y({template:I.innerHTML,self:H});F.appendChild(I.firstChild)}z.el.innerHTML=F.innerHTML},e=function(B,z){var A=B.index,D="",C="";if(B.value.indexOf("this.")>-1){D=B.value.replace("this.","");C=z.items[A][D];if(C!==undefined){if(typeof C==="string"){B.el.innerText=C}else{B.el.innerText=C.innerText}}}},f=function(B,z){var A=B.index,D="",C="";if(B.value.indexOf("this.")>-1){D=B.value.replace("this.","");C=z.items[A][D];if(typeof C==="string"){B.el.innerHTML=C}else{B.el.innerHTML=C.innerHTML}C.parentElement.removeChild(C)}};var l=function(){if(l.el===undefined){l._makeHTML({type:"overlay",object:l})}this.el=l.el;return this},b=function(){if(b.el===undefined){l._makeHTML({type:"modal",object:b})}this.el=b.el;return this},j=function(){if(j.el===undefined){l._makeHTML({type:"loading",object:j})}this.el=j.el;return this};j.prototype=l.prototype={show:function(){g(this.el).removeClass("moo-hidden")},hide:function(){g(this.el).setClass("moo-hidden")}};b.prototype={html:function(z){this.html=z;this.el.innerHTML=y({template:this.el.innerHTML,self:this})}};g.extend(l.prototype,b.prototype);g.extend({el:undefined,_makeHTML:function(A){var C=A.type,z=A.object,B=document.createElement("div");B.innerHTML=x[C];z.el=B.firstChild;g(z.el).setClass("moo-hidden");g(document.body).el.appendChild(z.el)}},l);var s=function(){};var q=function(z){this.input=z.el;g(this.input).hide();this._makeHTML();this._setTouchEvents();if(z.value){this.input.value=z.value}this.toggle(this.input.value);return this};q.prototype={_makeHTML:function(){var z;z=document.createElement("div");z.innerHTML=x.toggleswitch;this.el=z.firstChild;this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var B=this,C=g(B.el).find("b")[0],z=B.el.offsetWidth-32,A=0;B.x=0;B.isDragging=0;g(this.el).onTapEnd(function(D){B.toggle()});g(this.el).onSwipeRight(function(D){B._swipe=1});g(this.el).onSwipeLeft(function(D){B._swipe=-1});g(this.el).onDragMove(function(D){var E=B.x+(D.x-D.lastX);B.isDragging=1;g(B.el).removeClass("moo-on");g(B.el).removeClass("moo-off");D.e.stopPropagation();if((E<=z)&&(E>-4)){B.x=E;g(C).translateFx({x:B.x,y:0},{transitionDuration:0})}});g(this.el).onDragEnd(function(D){D.e.stopPropagation();g(C).cleanFx();if(B._swipe!==0&&D.time<400){if(B._swipe===1){B.toggle(1)}else{B.toggle(0)}}else{if(B.isDragging===1){B.isDragging=0;if(B.x<(z/2)){B.toggle(0)}else{B.toggle(1)}}}})},toggle:function(A){var z=g(this.el);if(A!==undefined){this.value=+A}else{if(this.value===0){this.value=1}else{this.value=0}}if(this.value===0){z.removeClass("moo-on");z.setClass("moo-off")}else{z.removeClass("moo-off");z.setClass("moo-on")}this.input.value=this.value;if(typeof this.onChange==="function"){this.onChange()}},on:function(z,A){if(z==="change"){this.onChange=A}}};var p=function(z){var A=0,B=this.pseudoItems=[];this.input=z.el;this.value=[];g(this.input).hide();this._makeHTML();B=g(this.container).find("div");for(A=0;A<B.length;A++){this.pseudoItems.push({el:B[A],value:B[A].value,mooSelectIndex:A})}this._setTouchEvents();if(z.value!==undefined){this.selectByValue(z.value)}return this};p.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=y({template:x.checkbox,self:this});this.container=g(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var z=this,A=0;for(A=0;A<this.pseudoItems.length;A++){g(this.pseudoItems[A].el).onTapEnd(function(E){var D=g(E.el),B=E.el.getAttribute("moo-foreach-index"),C=function(){if(D.hasClass("moo-active")){z.unselect(B)}else{z.select(B)}};if(g.context.userAgent==="android"){window.setTimeout(function(){C()},0)}else{C()}a(E)})}},select:function(z){if(this.value.indexOf(z)<0){this.value.push(z.toString());this.items[z].el.setAttribute("checked","checked");g(this.pseudoItems[z].el).setClass("moo-active")}},unselect:function(z){this.value.splice(this.value.indexOf(z),1);this.items[z].el.removeAttribute("checked","");g(this.pseudoItems[z].el).removeClass("moo-active")},unselectAll:function(){var z=0;for(z=this.items.length;z--;){this.unselect(z)}},selectByValue:function(B){var A,z;if(Object.prototype.toString.call(B)!=="[object Array]"){B=[B]}for(A=this.items.length;A--;){for(z=B.length;z--;){if(this.items[A].value===B[z]){g(this.pseudoItems[A].el).setClass("moo-active");this.select(A)}}}}};var r=function(z){var A=0,B=this.pseudoItems=[];this.input=z.el;g(this.input).hide();this._makeHTML();B=g(this.container).find("div");for(A=0;A<B.length;A++){this.pseudoItems.push({el:B[A],value:B[A].value,mooSelectIndex:A})}this._setTouchEvents();if(z.value!==undefined){this.selectByValue(z.value)}return this};r.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=y({template:x.radio,self:this});this.container=g(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var z=this,A=0;for(A=0;A<this.pseudoItems.length;A++){g(this.pseudoItems[A].el).onTapEnd(function(B){a(B);z.select(B.el.getAttribute("moo-foreach-index"))})}},select:function(A){var z=this,B;for(B=0;B<z.pseudoItems.length;B++){g(z.pseudoItems[B].el).removeClass("moo-active");z.pseudoItems[B].el.removeAttribute("checked","checked")}g(z.pseudoItems[A].el).setClass("moo-active");this.value=this.items[A].value;this.selectedIndex=A;this.input.selectedIndex=A;this.items[this.selectedIndex].el.setAttribute("checked","checked")},selectByValue:function(A){var z;for(z=this.items.length;z--;){if(this.items[z].value===A){this.select(z)}}}};var n=function(z){var A=0,B=this.pseudoItems=[];this.y=0;this.input=z.el;this._visibility="hidden";this._makeHTML();this._setTouchEvents();B=g(this.input).find("option");for(A=0;A<B.length;A++){this.pseudoItems.push({el:B[A],mooSelectIndex:A})}if(z.value!==undefined){this.selectByValue(z.value)}this.select(0);return this};n.prototype={_makeHTML:function(){var B=document.createElement("div"),A=x.select,z=this.input.parentElement;B.innerHTML=y({template:A,self:this});this.el=B.firstChild;this.el.parentElement.insertBefore(this.input);z.appendChild(B);this.box=g(this.el).find(".moo-ui-select-menu")[0];this.textspan=g(this.el).find(".moo-ui-select-text")[0]},_setTouchEvents:function(){var z=this;g(this.input).onTapEnd(function(A){if(z._visibility!=="visible"){z.input.focus();z._visibility="visible"}});g(this.input).on("blur",function(){z._visibility="hidden"});g(this.input).on("change",function(){z.select(z.input.selectedIndex)});g(this.el).onDragStart(a)},select:function(A){var z=this;window.setTimeout(function(){g(z.box).hide();z._visibility="hidden"},100);this.value=this.pseudoItems[A].el.value;this.selectedIndex=A;this.input.selectedIndex=A;g(this.textspan).html(this.pseudoItems[A].el.innerText)},selectByValue:function(A){var z;for(z=this.pseudoItems.length;z--;){if(this.pseudoItems[z].el.value===A){this.select(z)}}}};var w=false,t=function(A){var z=this;this.el=this.input=A.el;if(A.value!==undefined){this.el.value=A.value}this.value=z.el.value;this._makeHTML();g(this.el).onDragStart(a);g(this.el).onTapEnd(function(B){B.el.focus();a(B)});g(this.cleanbox).onTapEnd(function(){z.clean()});this.el.onblur=function(){window.scrollTo(0,0)};return this};t.focused=false;t.prototype={_makeHTML:function(){var B,A=this.el.parentElement,z=this;this.cleanbox=document.createElement("div");this.cleanbox.innerHTML=x.text;B=document.createElement("div");g(B).setClass("moo-ui-text");B.appendChild(this.cleanbox);B.appendChild(this.input);g(this.input).on("keyup",function(C){z.value=z.input.value;if(typeof z.onChange==="function"){z.onChange()}});A.appendChild(B)},clean:function(){this.input.value="";this.input.focus()},on:function(z,A){if(z==="change"){this.onChange=A}}};var u=function(A){var z=this;this.el=this.input=A.el;if(A.value!==undefined){this.el.innerHTML=A.value}this.value=z.el.innerHTML;this._makeHTML();g(this.el).onDragStart(a);g(this.el).onTapEnd(function(B){B.el.focus();a(B)});return this};u.prototype={_makeHTML:function(){var B,A=this.el.parentElement,z=this;g(this.input).on("keyup",function(C){z.value=z.input.value});B=document.createElement("div");g(B).setClass("moo-ui-textarea");B.appendChild(this.input);A.appendChild(B)}};var h=function(z){this.input=z.el;this.position=z.position;this.count=0;h._makeHTML(z,this);h._setTouchEvents(this);h._initProperties(this,z);if(z.value!==undefined){this.value=z.value}else{this.value=[]}return this};h.prototype={show:function(){if(typeof this.onShowBox==="function"){this.onShowBox()}g(this.el).show();this._visibility="visible"},hide:function(){g(this.el).hide();this._visibility="hidden"},onShowBox:function(z){this.onShowBox=z},onCamera:function(z){this.onCamera=z},onSuccess:function(z){this.onSuccess=z},onFail:function(z){this.onFail=z},onChange:function(z){this.onChange=z},push:function(D){var z=document.createElement("div"),C,B=this,A;z.innerHTML=this.imageWrapper.outerHTML;A=g(z).find(".moo-image");C=A[0];C.setAttribute("moo-index",this.count);A=g(B.imageList).find("li");for(i=A.length;i--;){g(A[i].firstChild).removeClass("moo-active")}g(C).setClass("moo-active");B.itemSelected=this.count;g(C).onTapEnd(function(H){var G=g(H.el),F,E=g(B.imageList).find("li");if(G.hasClass("moo-active")===false){for(F=E.length;F--;){g(E[F].firstChild).removeClass("moo-active")}g(H.el).setClass("moo-active");B.itemSelected=H.el.getAttribute("moo-index")}});C.appendChild(D);this.value.push(D.getAttribute("src"));g(z.firstChild).show();this.imageList.appendChild(z.firstChild);g(this.el).removeClass("moo-empty");this.count++},clear:function(){var z=g(this.imageList).find("li"),A=0;for(A=z.length;A--;){this.imageList.removeChild(z[A])}this.count=0;this.value=[]},removeItem:function(A){var z=g(this.imageList).find("li"),B=0;console.log("remove item!");this.imageList.removeChild(z[B]);this.value.splice(A,1);this.count=z.length-1;if(typeof this.onChange==="function"){this.onChange(this,A)}g(z[this.count]).setClass("moo-active");this.itemSelected=this.count}};g.extend({_makeHTML:function(B,A){var C=document.createElement("div"),z;C.innerHTML=x.camera;A.el=C.firstChild;z=g(A.el);z.setClass("moo-empty");if(A.position==="top"){z.setClass("moo-top")}else{if(A.position==="bottom"){z.setClass("moo-bottom")}}A.takeButton=z.find(".moo-ui-add-new")[0];A.chooseButton=z.find(".moo-ui-add-filed")[0];if(B.labelTakeButton!==undefined){A.takeButton.innerHTML=B.labelTakeButton}if(B.labelChooseButton!==undefined){A.chooseButton.innerHTML=B.labelChooseButton}A.imageWrapper=z.find(".moo-image-wrapper")[0];A.imageList=z.find(".moo-image-list")[0];z.hide();A._visibility="hidden";A.input.appendChild(A.el);g(A.imageWrapper).hide()},_setTouchEvents:function(z){g(z.input).onTapEnd(function(){if(z._visibility==="hidden"){z.show()}else{z.hide()}});g(z.el).onTapEnd(function(){z.hide()});g(z.takeButton).onTapEnd(function(){h.camera(z)});g(z.chooseButton).onTapEnd(function(){h.camera(z,"album")})},_initProperties:function(z,A){z.quality=z.quality?z.quality:50;z.width=z.width?z.width:1024;z.height=z.height?z.height:768},camera:function(z,A){var B,C;if(typeof z.onCamera==="function"){z.onCamera()}if(z.disabled!==true){if(window.Camera!==undefined){if(A==="album"){B=window.Camera.PictureSourceType.SAVEDPHOTOALBUM}C=function(D){z.onSuccess(D)};navigator.camera.getPicture(C,z.onFail,{quality:z.quality,destinationType:window.Camera.DestinationType.FILE_URI,sourceType:B,targetWidth:z.width,targetHeight:z.height})}else{console.log("Not camera! using sample pic");z.onSuccess("img/temp/samplepic.jpg")}}}},h);var d=function(z){this.input=z.el;this.sourceType=z.sourceType;d._setTouchEvents(this);d._initProperties(this,z);if(z.value!==undefined){this.value=z.value}else{this.value=[]}return this};d.prototype={onCamera:function(z){this.onCamera=z},onSuccess:function(z){this.onSuccess=z},onFail:function(z){this.onFail=z},onChange:function(z){this.onChange=z},};g.extend({_setTouchEvents:function(z){if(z.sourceType==="album"){g(z.input).onTapEnd(function(){h.camera(z,"album")})}else{g(z.input).onTapEnd(function(){h.camera(z)})}},_initProperties:function(z,A){z.quality=z.quality?z.quality:50;z.width=z.width?z.width:1024;z.height=z.height?z.height:768},camera:function(z,A){var B,C;if(typeof z.onCamera==="function"){z.onCamera()}if(z.disabled!==true){if(window.Camera!==undefined){if(A==="album"){B=window.Camera.PictureSourceType.SAVEDPHOTOALBUM}C=function(D){z.onSuccess(D)};navigator.camera.getPicture(C,z.onFail,{quality:z.quality,destinationType:window.Camera.DestinationType.FILE_URI,sourceType:B,targetWidth:z.width,targetHeight:z.height})}else{console.log("Not camera! using sample pic");z.onSuccess("img/temp/samplepic.jpg")}}}},d);var k=function(){};g.extend({ui:function(z){var A=k.get(this.query);if(A===undefined){z.el=this.el;switch(z.type){case"ToggleSwitch":A=new q(z);break;case"Text":A=new t(z);break;case"TextArea":A=new u(z);break;case"Select":A=new n(z);break;case"Radio":A=new r(z);break;case"Checkbox":A=new p(z);break;case"Camera":A=new h(z);break;case"SimpleCamera":A=new d(z);break}A.id=this.query;A.type=z.type;k.push(A);return A}else{return k.get(this.query)}}});var v={};g.extend({ui:{overlay:function(){return new l()},loading:function(){return new j()},modal:function(z){return new b()}}},g);g(document).ready(function(){var z=new l(),A=new j();g.extend({loadingScreen:{show:function(){z.show();A.show()},hide:function(){z.hide();A.hide()}}},g)});g.extend({_collection:[],get:function(A){var z;for(z=k._collection.length;z--;){if(k._collection[z].id===A){return k._collection[z]}}},push:function(z){this._collection.push(z)}},k);var a=function(z){z.e.stopPropagation();z.e.preventDefault()}}(Mootor));