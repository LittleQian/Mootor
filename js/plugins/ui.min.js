(function(f){var t={radio:'<div moo-template="foreach: input"><div class="moo-ui-radio"><label><span class="moo-ui-radio-label" moo-template="text: this.label"></span><span class="moo-ui-radio-icon"> &nbsp;</span></label></div></div>',checkbox:'<div moo-template="foreach: input"><div class="moo-ui-checkbox"><label><span class="moo-ui-checkbox-label" moo-template="html: this.label"></span><span class="moo-ui-checkbox-icon"> &nbsp;</span></label></div></div>',overlay:"<div class='moo-overlay'></div>",loading:"<div class='moo-ui-loading'><div class='moo-ui-loading-block moo-loading-01'></div><div class='moo-ui-loading-block moo-loading-02'></div><div class='moo-ui-loading-block moo-loading-03'></div><div class='moo-ui-loading-block moo-loading-04'></div><div class='moo-ui-loading-block moo-loading-05'></div><div class='moo-ui-loading-block moo-loading-06'></div><div class='moo-ui-loading-block moo-loading-07'></div><div class='moo-ui-loading-block moo-loading-08'></div></div>",modal:"<div class='moo-ui-modal-container'><div class='moo-ui-modal-panel' moo-template='html: this.html'></div></div>",_switch:"<div class='moo-ui-switch'><b><span class='moo-before'>I</span><span class='moo-button'>&nbsp;</span><span class='moo-after'>O</span></b></div>",text:'<span class="cleanbox">&times</span>',select:'<div class="moo-ui-select-container"><span class="moo-ui-select-text"></span><span class="moo-ui-select-link"> &#9660;</span><div class="moo-ui-select-menu" style="height:217px;display:none"><div class="moo-ui-select-wrapper"><ul class="moo-ui-select-list" moo-template="foreach: option"><li moo-template="text: this.text"></li></ul></div></div></div>',camera:"<div class='moo-ui-image-container'><header><a class='moo-ui-add-new' href='#takepic'>Take a picture</a><a class='moo-ui-add-filed' href='#choosepic'>Choose a picture</a><a class='moo-ui-delete' href='#delete'></a><a class='moo-ui-add-comment' href='#addcomment'></a></header><div class='moo-ui-image-panel'><ul class='moo-image-list'><li class='moo-image-wrapper'><div class='moo-image'></div></li></ul></div></div>",},m=function(v){return v.split(" ").join("")},u=function(D){var B=D.template,C=D.self,v=[],y=document.createElement("div"),A=[],w=0,z=[],x;y.innerHTML=B;A=y.getElementsByTagName("*");for(w=A.length;w--;){if(A[w].getAttribute("moo-template")!==null){z=m(A[w].getAttribute("moo-template")).split(":");v.push({el:A[w],key:z[0],value:z[1]})}if((x=A[w].getAttribute("moo-foreach-index"))!==null){v[w].index=x}}if(c(v)===true){for(w=v.length;w--;){if(v[w].key==="foreach"){k(v[w],C)}}}else{for(w=v.length;w--;){switch(v[w].key){case"text":d(v[w],C);break;case"html":e(v[w],C);break}}}return y.innerHTML},c=function(w){var v;for(v=w.length;v--;){if(w[v].key==="foreach"){return true}}return false},k=function(v,D){var F=v.value,z=D.input.getElementsByTagName(F),w=0,E={},x=v.el.innerHTML,A=[],C,y=[],B=document.createElement("div");D.items=[];A=f(D.input).find(F);if(F==="input"){y=f(D.input).find("label")}for(w=0;w<A.length;w++){D.items.push({el:A[w],text:A[w].innerText});C=D.items[D.items.length-1];if(F==="input"){C.label=y[w]}if(C.el.value!==undefined){C.value=C.el.value}}v.el.innerHTML="";for(w=0;w<z.length;w++){E=document.createElement("div");E.innerHTML=x;E.firstChild.setAttribute("moo-foreach-index",w);E.firstChild.setAttribute("moo-foreach-value",D.items[w].value);E.innerHTML=u({template:E.innerHTML,self:D});B.appendChild(E.firstChild)}v.el.innerHTML=B.innerHTML},d=function(x,v){var w=x.index,z="",y="";if(x.value.indexOf("this.")>-1){z=x.value.replace("this.","");y=v.items[w][z];if(typeof y==="string"){x.el.innerText=y}else{x.el.innerText=y.innerText}}},e=function(x,v){var w=x.index,z="",y="";if(x.value.indexOf("this.")>-1){z=x.value.replace("this.","");y=v.items[w][z];if(typeof y==="string"){x.el.innerHTML=y}else{x.el.innerHTML=y.innerHTML}y.parentElement.removeChild(y)}};var j=function(){if(j.el===undefined){j._makeHTML({type:"overlay",object:j})}this.el=j.el;return this},b=function(){if(b.el===undefined){j._makeHTML({type:"modal",object:b})}this.el=b.el;return this},h=function(){if(h.el===undefined){j._makeHTML({type:"loading",object:h})}this.el=h.el;return this};h.prototype=j.prototype={show:function(){f(this.el).removeClass("moo-hidden")},hide:function(){f(this.el).setClass("moo-hidden")},};b.prototype={html:function(v){this.html=v;this.el.innerHTML=u({template:this.el.innerHTML,self:this})}};f.extend(j.prototype,b.prototype);f.extend({el:undefined,_makeHTML:function(w){var y=w.type,v=w.object,x=document.createElement("div");x.innerHTML=t[y];v.el=x.firstChild;f(v.el).setClass("moo-hidden");f(document.body).el.appendChild(v.el)}},j);var p=function(){};var r=function(w){var v=this;this.input=w.el;f(this.input).hide();this._makeHTML();this._setTouchEvents();if(w.value){this.input.value=w.value}this.toggle(this.input.value);return this};r.prototype={_makeHTML:function(){var v;v=document.createElement("div");v.innerHTML=t._switch;this.el=v.firstChild;this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var x=this,y=f(x.el).find("b")[0],v=x.el.offsetWidth-32,z=v/3,w=0;x.x=0;x.isDragging=0;f(this.el).onTapEnd(function(A){x.toggle()});f(this.el).onSwipeRight(function(A){x._swipe=1});f(this.el).onSwipeLeft(function(A){x._swipe=-1});f(this.el).onDragMove(function(A){var B=x.x+(A.x-A.lastX);x.isDragging=1;f(x.el).removeClass("moo-on");f(x.el).removeClass("moo-off");A.e.stopPropagation();if((B<=v)&&(B>-4)){x.x=B;f(y).translateFx({x:x.x,y:0},{transitionDuration:0})}});f(this.el).onDragEnd(function(A){var B;A.e.stopPropagation();f(y).cleanFx();if(x._swipe!==0&&A.time<400){if(x._swipe===1){x.toggle(1)}else{x.toggle(0)}}else{if(x.isDragging===1){x.isDragging=0;if(x.x<(v/2)){x.toggle(0)}else{x.toggle(1)}}}})},toggle:function(w){var v=f(this.el);if(w!==undefined){this.value=+w}else{if(this.value===0){this.value=1}else{this.value=0}}if(this.value===0){v.removeClass("moo-on");v.setClass("moo-off")}else{v.removeClass("moo-off");v.setClass("moo-on")}this.input.value=this.value;if(typeof this.onChange==="function"){this.onChange()}},on:function(v,w){switch(v){case"change":this.onChange=w;break}}};var n=function(w){var v=this,x=0,y=this.pseudoItems=[];this.input=w.el;this.value=[];f(this.input).hide();this._makeHTML();y=f(this.container).find("div");for(x=0;x<y.length;x++){this.pseudoItems.push({el:y[x],value:y[x].value,mooSelectIndex:x})}this._setTouchEvents();if(w.value!==undefined){this.selectByValue(w.value)}return this};n.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=u({template:t.checkbox,self:this});this.container=f(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var v=this,w=0;for(w=0;w<this.pseudoItems.length;w++){f(this.pseudoItems[w].el).onTapEnd(function(z){var y,x=f(z.el);a(z);if(x.hasClass("moo-active")){v.unselect(z.el.getAttribute("moo-foreach-index"))}else{v.select(z.el.getAttribute("moo-foreach-index"))}})}},select:function(v){if(this.value.indexOf(v)<0){this.value.push(v.toString());this.items[v].el.setAttribute("checked","checked");f(this.pseudoItems[v].el).setClass("moo-active")}},unselect:function(v){this.value.splice(this.value.indexOf(v),1);this.items[v].el.removeAttribute("checked","");f(this.pseudoItems[v].el).removeClass("moo-active")},unselectAll:function(){var v=0;for(v=this.items.length;v--;){this.unselect(v)}},selectByValue:function(x){var w,v;if(Object.prototype.toString.call(x)!=="[object Array]"){x=[x]}for(w=this.items.length;w--;){for(v=x.length;v--;){if(this.items[w].value===x[v]){f(this.pseudoItems[w].el).setClass("moo-active");this.select(w)}}}}};var o=function(w){var v=this,x=0,y=this.pseudoItems=[];this.input=w.el;f(this.input).hide();this._makeHTML();y=f(this.container).find("div");for(x=0;x<y.length;x++){this.pseudoItems.push({el:y[x],value:y[x].value,mooSelectIndex:x})}this._setTouchEvents();if(w.value!==undefined){this.selectByValue(w.value)}return this};o.prototype={_makeHTML:function(){this.el=document.createElement("div");this.el.innerHTML=u({template:t.radio,self:this});this.container=f(this.el).find("div")[0];this.input.parentElement.appendChild(this.el)},_setTouchEvents:function(){var v=this,w=0;for(w=0;w<this.pseudoItems.length;w++){f(this.pseudoItems[w].el).onTapEnd(function(x){a(x);v.select(x.el.getAttribute("moo-foreach-index"))})}},select:function(w){var v=this,x;for(x=0;x<v.pseudoItems.length;x++){f(v.pseudoItems[x].el).removeClass("moo-active");v.pseudoItems[x].el.removeAttribute("checked","checked")}f(v.pseudoItems[w].el).setClass("moo-active");this.value=this.items[w].value;this.selectedIndex=w;this.input.selectedIndex=w;this.items[this.selectedIndex].el.setAttribute("checked","checked")},selectByValue:function(w){var v;for(v=this.items.length;v--;){if(this.items[v].value===w){this.select(v)}}}};var l=function(w){var v=this,x=0,y=this.pseudoItems=[];this.y=0;this.input=w.el;this.position=w.position;f(this.input).hide();this._makeHTML();this._setTouchEvents();y=f(this.ul).find("li");for(x=0;x<y.length;x++){this.pseudoItems.push({el:y[x],mooSelectIndex:x})}if(w.value!==undefined){this.selectByValue(w.value)}return this};l.prototype={_makeHTML:function(){var w=document.createElement("div"),v=t.select;w.innerHTML=u({template:v,self:this});this.el=w.firstChild;if(this.position=="top"){f(this.el).setClass("moo-top")}else{if(this.position=="bottom"){f(this.el).setClass("moo-bottom")}}this.input.parentElement.appendChild(this.el);this.ul=f(this.el).find("ul")[0];this.box=f(this.el).find(".moo-ui-select-menu")[0];this.textspan=f(this.el).find(".moo-ui-select-text")[0]},_setTouchEvents:function(){var v=this;f(this.el).onTapEnd(function(w){f(v.box).show()});f(this.el).onDragStart(a);f(this.ul).onTapEnd(function(x){var w;a(x);for(w=0;w<v.pseudoItems.length;w++){f(v.pseudoItems[w].el).removeClass("selected")}f(x.e.target).setClass("selected");v.select(x.e.target.getAttribute("moo-foreach-index"))});f(this.ul).onDragMove(function(x){var y,w;a(x);y=v.y+(x.y-x.lastY);if((y<=0)&&(y>=-(v.ul.offsetHeight-160))){v.y=y;f(v.ul).translateFx({x:0,y:v.y},{})}})},select:function(w){var v=this;window.setTimeout(function(){f(v.box).hide()},100);this.value=this.items[w].value;this.selectedIndex=w;this.input.selectedIndex=w;f(this.textspan).html(this.pseudoItems[w].el.innerHTML)},selectByValue:function(w){var v;for(v=this.items.length;v--;){if(this.items[v].value===w){this.select(v)}}}};var q=function(w){var v=this;this.el=this.input=w.el;if(w.value!==undefined){this.el.value=w.value}this.value=v.el.value;this._makeHTML();f(this.el).onDragStart(a);f(this.el).onTapEnd(function(x){x.el.focus();x.el.onblur=function(){window.scrollTo(0,0)};a(x)});f(this.cleanbox).onTapEnd(function(){v.clean()});return this};q.prototype={_makeHTML:function(){var x,w=this.el.parentElement,v=this;this.cleanbox=document.createElement("div");this.cleanbox.innerHTML=t.text;x=document.createElement("div");f(x).setClass("moo-ui-text");x.appendChild(this.cleanbox);x.appendChild(this.input);f(this.input).on("keyup",function(y){v.value=v.input.value;if(typeof v.onChange==="function"){v.onChange()}});w.appendChild(x)},clean:function(){this.input.value="";this.input.focus()},on:function(v,w){switch(v){case"change":this.onChange=w;break}}};var s=function(w){var v=this;this.el=this.input=w.el;if(w.value!==undefined){this.el.innerHTML=w.value}this.value=v.el.innerHTML;this._makeHTML();f(this.el).onDragStart(a);f(this.el).onTapEnd(function(x){x.el.focus();a(x)});return this};s.prototype={_makeHTML:function(){var x,w=this.el.parentElement,v=this;f(this.input).on("keyup",function(y){v.value=v.input.value});x=document.createElement("div");f(x).setClass("moo-ui-textarea");x.appendChild(this.input);w.appendChild(x)},};var g=function(v){this.input=v.el;this.position=v.position;this.count=0;g._makeHTML(v,this);g._setTouchEvents(this);g._initProperties(this,v);if(v.value!==undefined){this.value=v.value}else{this.value=[]}return this};g.prototype={show:function(){if(typeof this.onShowBox==="function"){this.onShowBox()}f(this.el).show()},hide:function(){f(this.el).hide()},onShowBox:function(v){this.onShowBox=v},onCamera:function(v){this.onCamera=v},onSuccess:function(v){this.onSuccess=v},onFail:function(v){this.onFail=v},push:function(x){var v=document.createElement("div"),w;v.innerHTML=this.imageWrapper.outerHTML;w=f(v).find(".moo-image")[0];w.appendChild(x);this.value.push(x.getAttribute("src"));f(v.firstChild).show();this.imageList.appendChild(v.firstChild);f(this.el).removeClass("moo-empty");this.count++},clear:function(){var v=f(this.imageList).find("li"),w=0;for(w=v.length;w--;){this.imageList.removeChild(v[w])}this.count=0;this.value=[]}};f.extend({_makeHTML:function(w,v){var y=w.type,x=document.createElement("div");x.innerHTML=t.camera;v.el=x.firstChild;f(v.el).setClass("moo-empty");if(v.position=="top"){f(v.el).setClass("moo-top")}else{if(v.position=="bottom"){f(v.el).setClass("moo-bottom")}}v.takeButton=f(v.el).find(".moo-ui-add-new")[0];v.chooseButton=f(v.el).find(".moo-ui-add-filed")[0];v.imageWrapper=f(v.el).find(".moo-image-wrapper")[0];v.imageList=f(v.el).find(".moo-image-list")[0];f(v.el).hide();v.input.appendChild(v.el);f(v.imageWrapper).hide()},_setTouchEvents:function(v){f(v.input).onTapEnd(function(){v.show()});f(v.el).onTapEnd(function(){v.hide()});f(v.takeButton).onTapEnd(function(){g.camera(v)});f(v.chooseButton).onTapEnd(function(){g.camera(v,"album")})},_initProperties:function(v,w){v.quality=v.quality?v.quality:50;v.width=v.width?v.width:1024;v.height=v.height?v.height:768},camera:function(v,w){var x;if(typeof v.onCamera==="function"){v.onCamera()}if(v.disabled!==true){if(window.Camera!==undefined){if(w==="album"){x=window.Camera.PictureSourceType.SAVEDPHOTOALBUM}var y=function(z){v.onSuccess(z)};navigator.camera.getPicture(y,v.onFail,{quality:v.quality,destinationType:window.Camera.DestinationType.FILE_URI,sourceType:x,targetWidth:v.width,targetHeight:v.height,})}else{console.log("Not camera! using sample pic");v.onSuccess("img/temp/samplepic.jpg")}}}},g);var i=function(){};f.extend({ui:function(v){var w=i.get(this.query);if(w===undefined){v.el=this.el;switch(v.type){case"Switch":w=new r(v);break;case"Text":w=new q(v);break;case"TextArea":w=new s(v);break;case"Select":w=new l(v);break;case"Radio":w=new o(v);break;case"Checkbox":w=new n(v);break;case"Camera":w=new g(v);break}w.id=this.query;w.type=v.type;i.push(w);return w}else{return i.get(this.query)}}});f.extend({ui:{overlay:function(){return new j()},loading:function(){return new h()},modal:function(v){return new b()}}},f);f.extend({_collection:[],get:function(w){var v;for(v=i._collection.length;v--;){if(i._collection[v].id===w){return i._collection[v]}}},push:function(v){this._collection.push(v)}},i);var a=function(v){v.e.stopPropagation();v.e.preventDefault()}}(Mootor));