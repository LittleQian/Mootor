(function(e){var b=function(h){b.init(h,this);this.header=new g(this);this.footer=new d(this);return this},a=function(h){this.el=h.el;this.id=this.el.id;this.index=h.index;this.height=h.height;this.x=h.x;this.y=h.y;return this};b.prototype={set:function(i){var h=this.get(i);if(this.current!==h.index){this._config.back=this.current;if(this._config.direction===0){this.history.push(this.current)}this.current=h.index;if(this._config.isMoving===false){this._config.isMoving=true;b.load(this)}}else{this._config.isMoving=false}return h},get:function(j){var h;for(h=this._config.count;h--;){if(this.items[h].el.id===j){return this.items[h]}}return null},goBack:function(){if(this.history.length>0){if(this._config.isMoving===false){this._config.direction=-1;this._config.back=this.history.pop();this.set(this.items[this._config.back].el.id)}}return this.items[this.current].index},handleGesture:function(h){b.handleGesture(h,this)},};e.extend({getLinks:function(j,k){var h,m,l=[];h=e(j.el).find("."+k._config.navClass);for(m=0;m<h.length;m++){if(h[m].getAttribute("href").replace("#","")!==""){l.push(h[m])}}return l},loadNavigationItem:function(m,j,k){var l=0,h="";for(l=j.navigationItemsCount;l--;){e(j.navigationItems[l]).removeClass("active")}k._config.direction=0;if(k._config.isMoving===false){h=m.el.getAttribute("href").replace("#","");if(h!==""){k.set(h)}}},initNavigationItems:function(h,j){var l,k;h.navigationItems=a.getLinks(h,j);h.navigationItemsCount=h.navigationItems.length;for(k=h.navigationItemsCount;k--;){l=h.navigationItems[k];if(e(l).hasClass(j._config.navClass)===false){e(l).onTapEnd(function(i){window.location=i.el.href})}else{if(l.getAttribute("href").replace("#","")!==""){e(l).onTapStart(function(i){e(i.el).setClass("active")});e(l).onTapEnd(function(i){a.loadNavigationItem(i,h,j)})}}}return h}},a);e.extend({_collection:[],init:function(i,h){h.el=i.el;h._options=i;b.initProperties(h,i);e(h.el).setClass(h._config.containerClassName);b.initItems(h);e(h.el).onDragMove(h);e(h.el).onDragEnd(h);b.initResizeEvents(h);return h},initProperties:function(h,i){var j;h._config={x:0,y:0,back:0,isMoving:false,direction:0,width:e.view.clientW,height:e.view.clientH,headerClassName:i.headerClassName?i.headerClassName:"moo-header",navClass:i.navLinksClassName?i.navLinksClassName:"moo-nav",hiddenClassName:i.hiddenClassName?i.hiddenClassName:"moo-hidden",margin:i.margin?i.margin:5,containerClassName:i.containerClassName?i.containerClassName:"moo-panels",itemClass:i.itemsClassName?i.itemsClassName:"moo-panel",type:i.type?i.type:"Panels"};switch(h._config.type){case"Panels":j=c}h._config.navItem=j;h.items=[];h.current=0;h.history=[];b._collection.push(h);h.id=i.id?i.id:i._query},handleGesture:function(i,h){i.e.preventDefault();switch(i.type){case"dragMove":b.move(i,h);break;case"dragEnd":h._config.navItem.checkMove(i,h);break}},nav:function(i,h){i._anchors=h.el.getElementsByClassName(h._options.navClass)},move:function(i,h){var j=h.items[h.current];if(i.isDraggingY!==0&&j.movable!==false){h._config.navItem.move(h,j,i)}},load:function(h){h._config.navItem.load(h)},initResizeEvents:function(h){e(window).bind("resize",function(){setTimeout(function(){if(h.header!==undefined){h._config.height=e.view.clientH-h.header.height}else{h._config.height=e.view.clientH}},1)})},initItems:function(h){var j,k,l=h.el.getElementsByClassName(h._config.itemClass);h.items=[];for(j=0;j<l.length;j++){k=new a({el:l[j],index:j,x:0,y:0,});a.initNavigationItems(k,h);h.items.push(k)}h._config.count=j;b.initNavItemStyles(h)},initNavItemStyles:function(h){h._config.navItem.initStyles(h)},preventNativeScrolling:function(){e(document).ready(function(){e(document.body).bind("touchmove",function(h){h.preventDefault();h.stopPropagation()})})},get:function(h){return b._collection.map(function(i){if(i.id===h){return i}})[0]}},b);e.extend({nav:function(h){var i;if(typeof h!=="object"){h={}}h.el=this.el;h._query=this.query;i=b.get(this.query);if(i===undefined){switch(h.type){default:return new b(h)}}else{return i}},});b.preventNativeScrolling();var g=function(h){this.el=e("header")[0];if(this.el!==null){this.height=this.el.offsetHeight;e(this.el).setClass(h._config.headerClassName);g.initAnchorBack(this,h);g.initNavigationLinks(this,h);g.preventNativeScrolling(this);h._config.navItem.setStylesWhenHeaderActive(this.height,h);return this}else{return undefined}};g.prototype={setTitle:function(h){e(this.el).find("h1")[0].innerText=h}};e.extend({initAnchorBack:function(h,i){var j=i._config.anchorBack=e(e(h.el).find(".moo-nav-back")[0]);j.hide();j.el.onclick=function(){return false};j.onTapEnd(function(k){i.goBack()})},preventNativeScrolling:function(h){e(h.el).onDragMove(function(i){i.e.preventDefault()})},initNavigationLinks:function(h,j){var l=e(h.el).find(".moo-nav"),k;for(k=l.length;k--;){e(l[k]).onTapEnd(function(i){a.loadNavigationItem(i,h,j)})}}},g);var d=function(h){};var c=function(){},f=function(h){h.duration=h.duration?h.duration:0;h.callback=h.callback?h.callback:function(){};h.y=h.y?h.y:0;h.x=h.x?h.x:0;e(h.el).translateFx({y:h.y,x:h.x},{transitionDuration:h.duration,callback:h.callback})};e.extend({load:function(k){var h,o,j,m,n,l;h=k.items[k.current];j=k.items[k._config.back];e(h.el).show();o=function(){e(j.el).hide();k._config.isMoving=false;h.x=0;k._config.x=0;f({el:k.el,x:0},k);f({el:h.el,x:0},k)};m=k._config.width+k._config.margin;if(k.current!==0){k._config.anchorBack.show()}else{k._config.anchorBack.hide()}if(k._config.direction===0||k._config.back===0){f({el:h.el,x:m},k);h.x=m;m=-m}else{f({el:h.el,x:-m},k);h.x=-m;m=m}window.setTimeout(function(){f({el:k.el,duration:0.25,x:m,callback:o},k)},1);if(typeof h.onLoadContent==="function"){h.onLoadContent();h.onLoadContentCallback=function(){if(h.navigationItems.length===0){a.initNavigationItems(h,k)}h.height=h.el.offsetHeight;if(k._config.height>h.height){h.height=k._config.height}}}if(typeof h.onLoad==="function"){h.onLoad()}},initStyles:function(h){var j=0,k={};for(j=h._config.count;j--;){k=h.items[j];if(j>0){f({el:k.el,x:-((h._config.width+h._config.margin)*4),y:0},h)}else{f({el:k.el,x:0},h)}k.height=k.el.offsetHeight;if(h._config.height>k.height){k.height=h._config.height}}},checkMove:function(l,j){var h=j.items[j.current],m=h.height-j._config.height,k;if(j.header!==undefined){m+=j.header.height}if(l.type==="dragEnd"){if(j._config.y>=0||m<-j._config.y){if(j._config.y>0){j._config.y=0}else{j._config.y=-m}for(k=h.navigationItems.length;k--;){e(h.navigationItems[k]).removeClass("active")}f({y:j._config.y,el:h.el,duration:0.25},j)}else{}}},move:function(h,j,i){h._config.y=h._config.y+(i.y-i.lastY);f({el:j.el,y:h._config.y,x:j.x},h)},setStylesWhenHeaderActive:function(h,j){var k;for(k=j._config.count;k--;){j.items[k].el.style.paddingTop=h+"px"}}},c)}(Mootor));